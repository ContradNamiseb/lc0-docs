<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Leela Chess Zero: chess/board.cc Source File</title>
<link href="../css/tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../js/jquery.js"></script>
<script type="text/javascript" src="../js/dynsections.js"></script>
<link href="../css/navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../js/resize.js"></script>
<script type="text/javascript" src="../js/navtreedata.js"></script>
<script type="text/javascript" src="../js/navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="../css/doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Leela Chess Zero<span id="projectnumber">&#160;dev</span>
   </div>
   <div id="projectbrief">Neural network based chess engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../js/menudata.js"></script>
<script type="text/javascript" src="../js/menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('pages/board_8cc_source.html','../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">board.cc</div></div>
</div><!--header-->
<div class="contents">
<a href="board_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">  This file is part of Leela Chess Zero.</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">  Copyright (C) 2018-2019 The LCZero Authors</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"></span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">  Leela Chess is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">  it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">  the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">  (at your option) any later version.</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"></span> </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">  Leela Chess is distributed in the hope that it will be useful,</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">  GNU General Public License for more details.</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"></span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">  You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">  along with Leela Chess.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment"></span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment">  Additional permission under GNU GPL version 3 section 7</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment"></span> </div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment">  If you modify this Program, or any covered work, by linking or</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">  combining it with NVIDIA Corporation&#39;s libraries from the NVIDIA CUDA</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment">  Toolkit and the NVIDIA CUDA Deep Neural Network library (or a</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment">  modified version of those libraries), containing parts covered by the</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment">  terms of the respective license agreement, the licensors of this</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="comment">  Program grant you additional permission to convey the resulting work.</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="comment">*/</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;<a class="code" href="board_8h.html">chess/board.h</a>&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &lt;cctype&gt;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &lt;charconv&gt;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &lt;absl/cleanup/cleanup.h&gt;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span> </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &quot;<a class="code" href="exception_8h.html">utils/exception.h</a>&quot;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#if not defined(NO_PEXT)</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="comment">// Include header for pext instruction.</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &lt;immintrin.h&gt;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacelczero.html">lczero</a> {</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a136b3c71ba506572774491470e28bc55">ChessBoard::kStartposFen</a> =</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    <span class="stringliteral">&quot;rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1&quot;</span>;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span> </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="keyword">const</span> ChessBoard <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a459676c5f973018a5d73bd59964a55f0">ChessBoard::kStartposBoard</a>(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a136b3c71ba506572774491470e28bc55">ChessBoard::kStartposFen</a>);</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="keyword">const</span> BitBoard <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aecd6a3874def234ec0244942531a2793">ChessBoard::kPawnMask</a> = 0x00FFFFFFFFFFFF00ULL;</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#a92cef3b5ecadb2db2f1f6cb693860a84">   55</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a92cef3b5ecadb2db2f1f6cb693860a84">ChessBoard::Clear</a>() { *<span class="keyword">this</span> = <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a4c33d4852a273e8844afe286affdb386">ChessBoard</a>(); }</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="foldopen" id="foldopen00057" data-start="{" data-end="}">
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#a71f55c55d217e5948991d54017b083bb">   57</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a71f55c55d217e5948991d54017b083bb">ChessBoard::Mirror</a>() {</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#adabc129aadaf4ae7bfd6aa884282d9d8">Mirror</a>();</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#adabc129aadaf4ae7bfd6aa884282d9d8">Mirror</a>();</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>  std::swap(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>, <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>);</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#adabc129aadaf4ae7bfd6aa884282d9d8">Mirror</a>();</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#adabc129aadaf4ae7bfd6aa884282d9d8">Mirror</a>();</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#adabc129aadaf4ae7bfd6aa884282d9d8">Mirror</a>();</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a4b08b1d00cc91a02873fd818c0f7beb4">Flip</a>();</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac3cb53799c242f72362f540ad77a4df9">their_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a4b08b1d00cc91a02873fd818c0f7beb4">Flip</a>();</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>  std::swap(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>, <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac3cb53799c242f72362f540ad77a4df9">their_king_</a>);</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#a5a7fc935a660287d3b76c1137fbce98e">Mirror</a>();</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#afbbcac155ea7795b5288da2512516e14">flipped_</a> = !<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#afbbcac155ea7795b5288da2512516e14">flipped_</a>;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>}</div>
</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span><span class="keyword">static</span> <span class="keyword">const</span> std::pair&lt;int, int&gt; kKingMoves[] = {</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    {-1, -1}, {-1, 0}, {-1, 1}, {0, -1}, {0, 1}, {1, -1}, {1, 0}, {1, 1}};</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span> </div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="keyword">static</span> <span class="keyword">const</span> std::pair&lt;int, int&gt; kRookDirections[] = {</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    {1, 0}, {-1, 0}, {0, 1}, {0, -1}};</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span><span class="keyword">static</span> <span class="keyword">const</span> std::pair&lt;int, int&gt; kBishopDirections[] = {</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    {1, 1}, {-1, 1}, {1, -1}, {-1, -1}};</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span> </div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="comment">// Which squares can rook attack from every of squares.</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span><span class="keyword">static</span> <span class="keyword">const</span> BitBoard kRookAttacks[] = {</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    0x01010101010101FEULL, 0x02020202020202FDULL, 0x04040404040404FBULL,</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    0x08080808080808F7ULL, 0x10101010101010EFULL, 0x20202020202020DFULL,</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    0x40404040404040BFULL, 0x808080808080807FULL, 0x010101010101FE01ULL,</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    0x020202020202FD02ULL, 0x040404040404FB04ULL, 0x080808080808F708ULL,</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    0x101010101010EF10ULL, 0x202020202020DF20ULL, 0x404040404040BF40ULL,</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    0x8080808080807F80ULL, 0x0101010101FE0101ULL, 0x0202020202FD0202ULL,</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    0x0404040404FB0404ULL, 0x0808080808F70808ULL, 0x1010101010EF1010ULL,</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    0x2020202020DF2020ULL, 0x4040404040BF4040ULL, 0x80808080807F8080ULL,</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    0x01010101FE010101ULL, 0x02020202FD020202ULL, 0x04040404FB040404ULL,</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    0x08080808F7080808ULL, 0x10101010EF101010ULL, 0x20202020DF202020ULL,</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    0x40404040BF404040ULL, 0x808080807F808080ULL, 0x010101FE01010101ULL,</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    0x020202FD02020202ULL, 0x040404FB04040404ULL, 0x080808F708080808ULL,</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    0x101010EF10101010ULL, 0x202020DF20202020ULL, 0x404040BF40404040ULL,</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    0x8080807F80808080ULL, 0x0101FE0101010101ULL, 0x0202FD0202020202ULL,</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    0x0404FB0404040404ULL, 0x0808F70808080808ULL, 0x1010EF1010101010ULL,</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    0x2020DF2020202020ULL, 0x4040BF4040404040ULL, 0x80807F8080808080ULL,</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    0x01FE010101010101ULL, 0x02FD020202020202ULL, 0x04FB040404040404ULL,</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    0x08F7080808080808ULL, 0x10EF101010101010ULL, 0x20DF202020202020ULL,</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    0x40BF404040404040ULL, 0x807F808080808080ULL, 0xFE01010101010101ULL,</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    0xFD02020202020202ULL, 0xFB04040404040404ULL, 0xF708080808080808ULL,</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    0xEF10101010101010ULL, 0xDF20202020202020ULL, 0xBF40404040404040ULL,</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    0x7F80808080808080ULL};</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span><span class="comment">// Which squares can bishop attack.</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span><span class="keyword">static</span> <span class="keyword">const</span> BitBoard kBishopAttacks[] = {</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    0x8040201008040200ULL, 0x0080402010080500ULL, 0x0000804020110A00ULL,</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    0x0000008041221400ULL, 0x0000000182442800ULL, 0x0000010204885000ULL,</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    0x000102040810A000ULL, 0x0102040810204000ULL, 0x4020100804020002ULL,</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    0x8040201008050005ULL, 0x00804020110A000AULL, 0x0000804122140014ULL,</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    0x0000018244280028ULL, 0x0001020488500050ULL, 0x0102040810A000A0ULL,</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    0x0204081020400040ULL, 0x2010080402000204ULL, 0x4020100805000508ULL,</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    0x804020110A000A11ULL, 0x0080412214001422ULL, 0x0001824428002844ULL,</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    0x0102048850005088ULL, 0x02040810A000A010ULL, 0x0408102040004020ULL,</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    0x1008040200020408ULL, 0x2010080500050810ULL, 0x4020110A000A1120ULL,</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    0x8041221400142241ULL, 0x0182442800284482ULL, 0x0204885000508804ULL,</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    0x040810A000A01008ULL, 0x0810204000402010ULL, 0x0804020002040810ULL,</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    0x1008050005081020ULL, 0x20110A000A112040ULL, 0x4122140014224180ULL,</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    0x8244280028448201ULL, 0x0488500050880402ULL, 0x0810A000A0100804ULL,</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    0x1020400040201008ULL, 0x0402000204081020ULL, 0x0805000508102040ULL,</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    0x110A000A11204080ULL, 0x2214001422418000ULL, 0x4428002844820100ULL,</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    0x8850005088040201ULL, 0x10A000A010080402ULL, 0x2040004020100804ULL,</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    0x0200020408102040ULL, 0x0500050810204080ULL, 0x0A000A1120408000ULL,</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    0x1400142241800000ULL, 0x2800284482010000ULL, 0x5000508804020100ULL,</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    0xA000A01008040201ULL, 0x4000402010080402ULL, 0x0002040810204080ULL,</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    0x0005081020408000ULL, 0x000A112040800000ULL, 0x0014224180000000ULL,</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    0x0028448201000000ULL, 0x0050880402010000ULL, 0x00A0100804020100ULL,</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    0x0040201008040201ULL};</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span><span class="comment">// Which squares can knight attack.</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span><span class="keyword">static</span> <span class="keyword">const</span> BitBoard kKnightAttacks[] = {</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    0x0000000000020400ULL, 0x0000000000050800ULL, 0x00000000000A1100ULL,</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    0x0000000000142200ULL, 0x0000000000284400ULL, 0x0000000000508800ULL,</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    0x0000000000A01000ULL, 0x0000000000402000ULL, 0x0000000002040004ULL,</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    0x0000000005080008ULL, 0x000000000A110011ULL, 0x0000000014220022ULL,</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    0x0000000028440044ULL, 0x0000000050880088ULL, 0x00000000A0100010ULL,</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    0x0000000040200020ULL, 0x0000000204000402ULL, 0x0000000508000805ULL,</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    0x0000000A1100110AULL, 0x0000001422002214ULL, 0x0000002844004428ULL,</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    0x0000005088008850ULL, 0x000000A0100010A0ULL, 0x0000004020002040ULL,</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    0x0000020400040200ULL, 0x0000050800080500ULL, 0x00000A1100110A00ULL,</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    0x0000142200221400ULL, 0x0000284400442800ULL, 0x0000508800885000ULL,</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    0x0000A0100010A000ULL, 0x0000402000204000ULL, 0x0002040004020000ULL,</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    0x0005080008050000ULL, 0x000A1100110A0000ULL, 0x0014220022140000ULL,</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    0x0028440044280000ULL, 0x0050880088500000ULL, 0x00A0100010A00000ULL,</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    0x0040200020400000ULL, 0x0204000402000000ULL, 0x0508000805000000ULL,</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    0x0A1100110A000000ULL, 0x1422002214000000ULL, 0x2844004428000000ULL,</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    0x5088008850000000ULL, 0xA0100010A0000000ULL, 0x4020002040000000ULL,</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    0x0400040200000000ULL, 0x0800080500000000ULL, 0x1100110A00000000ULL,</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    0x2200221400000000ULL, 0x4400442800000000ULL, 0x8800885000000000ULL,</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    0x100010A000000000ULL, 0x2000204000000000ULL, 0x0004020000000000ULL,</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    0x0008050000000000ULL, 0x00110A0000000000ULL, 0x0022140000000000ULL,</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    0x0044280000000000ULL, 0x0088500000000000ULL, 0x0010A00000000000ULL,</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    0x0020400000000000ULL};</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span><span class="comment">// Opponent pawn attacks</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span><span class="keyword">static</span> <span class="keyword">const</span> BitBoard kPawnAttacks[] = {</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    0x0000000000000200ULL, 0x0000000000000500ULL, 0x0000000000000A00ULL,</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    0x0000000000001400ULL, 0x0000000000002800ULL, 0x0000000000005000ULL,</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    0x000000000000A000ULL, 0x0000000000004000ULL, 0x0000000000020000ULL,</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    0x0000000000050000ULL, 0x00000000000A0000ULL, 0x0000000000140000ULL,</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    0x0000000000280000ULL, 0x0000000000500000ULL, 0x0000000000A00000ULL,</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    0x0000000000400000ULL, 0x0000000002000000ULL, 0x0000000005000000ULL,</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    0x000000000A000000ULL, 0x0000000014000000ULL, 0x0000000028000000ULL,</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    0x0000000050000000ULL, 0x00000000A0000000ULL, 0x0000000040000000ULL,</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    0x0000000200000000ULL, 0x0000000500000000ULL, 0x0000000A00000000ULL,</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    0x0000001400000000ULL, 0x0000002800000000ULL, 0x0000005000000000ULL,</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    0x000000A000000000ULL, 0x0000004000000000ULL, 0x0000020000000000ULL,</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    0x0000050000000000ULL, 0x00000A0000000000ULL, 0x0000140000000000ULL,</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    0x0000280000000000ULL, 0x0000500000000000ULL, 0x0000A00000000000ULL,</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    0x0000400000000000ULL, 0x0002000000000000ULL, 0x0005000000000000ULL,</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    0x000A000000000000ULL, 0x0014000000000000ULL, 0x0028000000000000ULL,</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    0x0050000000000000ULL, 0x00A0000000000000ULL, 0x0040000000000000ULL,</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL,</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL,</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL,</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL,</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL,</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    0x0000000000000000ULL};</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span> </div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span><span class="keyword">static</span> <span class="keyword">constexpr</span> PieceType kPromotions[] = {<a class="code hl_variable" href="namespacelczero.html#a1217b167970921dc66f9c7d134e07931">kQueen</a>, <a class="code hl_variable" href="namespacelczero.html#aedde9b45c7086de9aa43eaed7d6e3ba1">kRook</a>, <a class="code hl_variable" href="namespacelczero.html#a96f1f63d9271a0f81b3c94acb93b3d99">kBishop</a>, <a class="code hl_variable" href="namespacelczero.html#a2743992b7a93253ed85da4ca7a9280b6">kKnight</a>};</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span><span class="comment">// Magic bitboard routines and structures.</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span><span class="comment">// We use so-called &quot;fancy&quot; magic bitboards.</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span> </div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span><span class="comment">// Structure holding all relevant magic parameters per square.</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span><span class="keyword">struct </span>MagicParams {</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>  <span class="comment">// Relevant occupancy mask.</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno"><a class="line" href="board_8cc.html#aee3a0c29b42b0abb554798477e8d4029">  186</a></span>  uint64_t <a class="code hl_variable" href="board_8cc.html#aee3a0c29b42b0abb554798477e8d4029">mask_</a>;</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>  <span class="comment">// Pointer to lookup table.</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno"><a class="line" href="board_8cc.html#a7e57738e999c4baae71a2d86d07c2561">  188</a></span>  BitBoard* <a class="code hl_variable" href="board_8cc.html#a7e57738e999c4baae71a2d86d07c2561">attacks_table_</a>;</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span><span class="preprocessor">#if defined(NO_PEXT)</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>  <span class="comment">// Magic number.</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>  uint64_t magic_number_;</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>  <span class="comment">// Number of bits to shift.</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>  uint8_t shift_bits_;</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>};</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span><span class="preprocessor">#if defined(NO_PEXT)</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span><span class="comment">// Magic numbers determined via trial and error with random number generator</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span><span class="comment">// such that the number of relevant occupancy bits suffice to index the attacks</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span><span class="comment">// tables with only constructive collisions.</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span><span class="keyword">static</span> <span class="keyword">const</span> BitBoard kRookMagicNumbers[] = {</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    0x088000102088C001ULL, 0x10C0200040001000ULL, 0x83001041000B2000ULL,</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    0x0680280080041000ULL, 0x488004000A080080ULL, 0x0100180400010002ULL,</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    0x040001C401021008ULL, 0x02000C04A980C302ULL, 0x0000800040082084ULL,</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    0x5020C00820025000ULL, 0x0001002001044012ULL, 0x0402001020400A00ULL,</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    0x00C0800800040080ULL, 0x4028800200040080ULL, 0x00A0804200802500ULL,</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    0x8004800040802100ULL, 0x0080004000200040ULL, 0x1082810020400100ULL,</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    0x0020004010080040ULL, 0x2004818010042800ULL, 0x0601010008005004ULL,</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    0x4600808002001400ULL, 0x0010040009180210ULL, 0x020412000406C091ULL,</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    0x040084228000C000ULL, 0x8000810100204000ULL, 0x0084110100402000ULL,</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    0x0046001A00204210ULL, 0x2001040080080081ULL, 0x0144020080800400ULL,</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    0x0840108400080229ULL, 0x0480308A0000410CULL, 0x0460324002800081ULL,</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    0x620080A001804000ULL, 0x2800802000801006ULL, 0x0002809000800800ULL,</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    0x4C09040080802800ULL, 0x4808800C00800200ULL, 0x0200311004001802ULL,</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    0x0400008402002141ULL, 0x0410800140008020ULL, 0x000080C001050020ULL,</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    0x004080204A020010ULL, 0x0224201001010038ULL, 0x0109001108010004ULL,</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    0x0282004844020010ULL, 0x8228180110040082ULL, 0x0001000080C10002ULL,</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    0x024000C120801080ULL, 0x0001406481060200ULL, 0x0101243200418600ULL,</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    0x0108800800100080ULL, 0x4022080100100D00ULL, 0x0000843040600801ULL,</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    0x8301000200CC0500ULL, 0x1000004500840200ULL, 0x1100104100800069ULL,</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    0x2001008440001021ULL, 0x2002008830204082ULL, 0x0010145000082101ULL,</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    0x01A2001004200842ULL, 0x1007000608040041ULL, 0x000A08100203028CULL,</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    0x02D4048040290402ULL};</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span><span class="keyword">static</span> <span class="keyword">const</span> BitBoard kBishopMagicNumbers[] = {</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    0x0008201802242020ULL, 0x0021040424806220ULL, 0x4006360602013080ULL,</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>    0x0004410020408002ULL, 0x2102021009001140ULL, 0x08C2021004000001ULL,</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    0x6001031120200820ULL, 0x1018310402201410ULL, 0x401CE00210820484ULL,</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    0x001029D001004100ULL, 0x2C00101080810032ULL, 0x0000082581000010ULL,</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    0x10000A0210110020ULL, 0x200002016C202000ULL, 0x0201018821901000ULL,</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    0x006A0300420A2100ULL, 0x0010014005450400ULL, 0x1008C12008028280ULL,</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    0x00010010004A0040ULL, 0x3000820802044020ULL, 0x0000800405A02820ULL,</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    0x8042004300420240ULL, 0x10060801210D2000ULL, 0x0210840500511061ULL,</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    0x0008142118509020ULL, 0x0021109460040104ULL, 0x00A1480090019030ULL,</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    0x0102008808008020ULL, 0x884084000880E001ULL, 0x040041020A030100ULL,</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    0x3000810104110805ULL, 0x04040A2006808440ULL, 0x0044040404C01100ULL,</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    0x4122B80800245004ULL, 0x0044020502380046ULL, 0x0100400888020200ULL,</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    0x01C0002060020080ULL, 0x4008811100021001ULL, 0x8208450441040609ULL,</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    0x0408004900008088ULL, 0x0294212051220882ULL, 0x000041080810E062ULL,</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    0x10480A018E005000ULL, 0x80400A0204201600ULL, 0x2800200204100682ULL,</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    0x0020200400204441ULL, 0x0A500600A5002400ULL, 0x801602004A010100ULL,</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    0x0801841008040880ULL, 0x10010880C4200028ULL, 0x0400004424040000ULL,</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    0x0401000142022100ULL, 0x00A00010020A0002ULL, 0x1010400204010810ULL,</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    0x0829910400840000ULL, 0x0004235204010080ULL, 0x1002008143082000ULL,</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    0x11840044440C2080ULL, 0x2802A02104030440ULL, 0x6100000900840401ULL,</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    0x1C20A15A90420200ULL, 0x0088414004480280ULL, 0x0000204242881100ULL,</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    0x0240080802809010ULL};</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span><span class="comment">// Magic parameters for rooks/bishops.</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span><span class="keyword">static</span> MagicParams rook_magic_params[64];</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span><span class="keyword">static</span> MagicParams bishop_magic_params[64];</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span><span class="comment">// Precomputed attacks bitboard tables.</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span><span class="keyword">static</span> BitBoard rook_attacks_table[102400];</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span><span class="keyword">static</span> BitBoard bishop_attacks_table[5248];</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span> </div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span><span class="keyword">constexpr</span> <span class="keywordtype">bool</span> IsOnBoard(<span class="keywordtype">int</span> x) { <span class="keywordflow">return</span> x &gt;= 0 &amp;&amp; x &lt; 8; }</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span><span class="keyword">constexpr</span> <span class="keywordtype">bool</span> IsOnBoard(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y) { <span class="keywordflow">return</span> IsOnBoard(x) &amp;&amp; IsOnBoard(y); }</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>}  <span class="comment">// namespace</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span><span class="comment">// Builds rook or bishop attacks table.</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span><span class="keyword">static</span> <span class="keywordtype">void</span> BuildAttacksTable(MagicParams* magic_params,</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>                              BitBoard* attacks_table,</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>                              <span class="keyword">const</span> std::pair&lt;int, int&gt;* directions) {</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>  <span class="comment">// Offset into lookup table.</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>  uint32_t table_offset = 0;</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span> </div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>  <span class="comment">// Initialize for all board squares.</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> square = 0; square &lt; 64; square++) {</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    <span class="keyword">const</span> Square b_sq = <a class="code hl_function" href="classlczero_1_1Square.html#aec40d8b97f29773cc6672e67743e668d">Square::FromIdx</a>(square);</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    <span class="comment">// Calculate relevant occupancy masks.</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    BitBoard mask = {0};</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++) {</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>      <span class="keyword">auto</span> direction = directions[j];</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>      <span class="keyword">auto</span> dst_row = b_sq.rank().idx;</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>      <span class="keyword">auto</span> dst_col = b_sq.file().idx;</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>      <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>        dst_row += direction.first;</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>        dst_col += direction.second;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>        <span class="comment">// If the next square in this direction is invalid, the current square</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>        <span class="comment">// is at the board&#39;s edge and should not be added.</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>        <span class="keywordflow">if</span> (!IsOnBoard(dst_row + direction.first, dst_col + direction.second))</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>        <span class="keyword">const</span> Square destination(<a class="code hl_function" href="structlczero_1_1File.html#ab99e72565a1274701e4457b4228464ca">File::FromIdx</a>(dst_col),</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>                                 <a class="code hl_function" href="structlczero_1_1Rank.html#aeb6a8e026c4f15d6e56f19090ad374c6">Rank::FromIdx</a>(dst_row));</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>        mask.set(destination);</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>      }</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    }</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span> </div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    <span class="comment">// Set mask.</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    magic_params[square].mask_ = mask.as_int();</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span> </div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    <span class="comment">// Cache relevant occupancy board squares.</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    std::vector&lt;Square&gt; occupancy_squares;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span> </div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> occ_sq : BitBoard(magic_params[square].<a class="code hl_variable" href="board_8cc.html#aee3a0c29b42b0abb554798477e8d4029">mask_</a>)) {</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>      occupancy_squares.emplace_back(occ_sq);</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    }</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span><span class="preprocessor">#if defined(NO_PEXT)</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    <span class="comment">// Set number of shifted bits. The magic numbers have been chosen such that</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    <span class="comment">// the number of relevant occupancy bits suffice to index the attacks table.</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    magic_params[square].shift_bits_ = 64 - occupancy_squares.size();</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span> </div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    <span class="comment">// Set pointer to lookup table.</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    magic_params[square].attacks_table_ = &amp;attacks_table[table_offset];</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    <span class="comment">// Clear attacks table (used for sanity check later on).</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (1 &lt;&lt; occupancy_squares.size()); i++) {</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>      attacks_table[table_offset + i] = 0;</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>    }</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span> </div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>    <span class="comment">// Build square attacks table for every possible relevant occupancy</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    <span class="comment">// bitboard.</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (1 &lt;&lt; occupancy_squares.size()); i++) {</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>      BitBoard occupancy(0);</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span> </div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> bit = 0; bit &lt; occupancy_squares.size(); bit++) {</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>        occupancy.set_if(occupancy_squares[bit], (1 &lt;&lt; bit) &amp; i);</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>      }</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span> </div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>      <span class="comment">// Calculate attacks bitboard corresponding to this occupancy bitboard.</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>      BitBoard attacks(0);</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++) {</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>        <span class="keyword">auto</span> direction = directions[j];</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>        <span class="keyword">auto</span> dst_row = b_sq.rank().idx;</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>        <span class="keyword">auto</span> dst_col = b_sq.file().idx;</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>        <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>          dst_row += direction.first;</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>          dst_col += direction.second;</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>          <span class="keywordflow">if</span> (!IsOnBoard(dst_row, dst_col)) <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>          <span class="keyword">const</span> Square destination(<a class="code hl_function" href="structlczero_1_1File.html#ab99e72565a1274701e4457b4228464ca">File::FromIdx</a>(dst_col),</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>                                   <a class="code hl_function" href="structlczero_1_1Rank.html#aeb6a8e026c4f15d6e56f19090ad374c6">Rank::FromIdx</a>(dst_row));</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>          attacks.set(destination);</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>          <span class="keywordflow">if</span> (occupancy.get(destination)) <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>        }</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>      }</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span><span class="preprocessor">#if defined(NO_PEXT)</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>      <span class="comment">// Calculate magic index.</span></div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>      uint64_t index = occupancy.as_int();</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>      index *= magic_params[square].magic_number_;</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>      index &gt;&gt;= magic_params[square].shift_bits_;</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span> </div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>      <span class="comment">// Sanity check. The magic numbers have been chosen such that</span></div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>      <span class="comment">// the number of relevant occupancy bits suffice to index the attacks</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>      <span class="comment">// table. If the table already contains an attacks bitboard, possible</span></div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>      <span class="comment">// collisions should be constructive.</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>      <span class="keywordflow">if</span> (attacks_table[table_offset + index] != 0 &amp;&amp;</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>          attacks_table[table_offset + index] != attacks) {</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        <span class="keywordflow">throw</span> Exception(<span class="stringliteral">&quot;Invalid magic number!&quot;</span>);</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>      }</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>      uint64_t index =</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>          _pext_u64(occupancy.as_int(), magic_params[square].mask_);</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span> </div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>      <span class="comment">// Update table.</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>      attacks_table[table_offset + index] = attacks;</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    }</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    <span class="comment">// Update table offset.</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    table_offset += (1 &lt;&lt; occupancy_squares.size());</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>  }</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>}</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span> </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span><span class="comment">// Returns the rook attacks bitboard for the given rook board square and the</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span><span class="comment">// given occupied piece bitboard.</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span><span class="keyword">static</span> <span class="keyword">inline</span> BitBoard GetRookAttacks(<span class="keyword">const</span> Square rook_square,</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>                                      <span class="keyword">const</span> BitBoard <a class="code hl_variable" href="syzygy_8cc.html#a10beb4bd4f698799676f49c292153bb5">pieces</a>) {</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>  <span class="comment">// Calculate magic index.</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>  <span class="keyword">const</span> uint8_t square = rook_square.as_idx();</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span> </div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span><span class="preprocessor">#if defined(NO_PEXT)</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>  uint64_t index = <a class="code hl_variable" href="syzygy_8cc.html#a10beb4bd4f698799676f49c292153bb5">pieces</a>.as_int() &amp; rook_magic_params[square].mask_;</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>  index *= rook_magic_params[square].magic_number_;</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>  index &gt;&gt;= rook_magic_params[square].shift_bits_;</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>  uint64_t index = _pext_u64(<a class="code hl_variable" href="syzygy_8cc.html#a10beb4bd4f698799676f49c292153bb5">pieces</a>.as_int(), rook_magic_params[square].mask_);</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span> </div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>  <span class="comment">// Return attacks bitboard.</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>  <span class="keywordflow">return</span> rook_magic_params[square].attacks_table_[index];</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>}</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span><span class="comment">// Returns the bishop attacks bitboard for the given bishop board square and</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span><span class="comment">// the given occupied piece bitboard.</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span><span class="keyword">static</span> <span class="keyword">inline</span> BitBoard GetBishopAttacks(<span class="keyword">const</span> Square bishop_square,</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>                                        <span class="keyword">const</span> BitBoard <a class="code hl_variable" href="syzygy_8cc.html#a10beb4bd4f698799676f49c292153bb5">pieces</a>) {</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>  <span class="comment">// Calculate magic index.</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>  <span class="keyword">const</span> uint8_t square = bishop_square.as_idx();</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span> </div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span><span class="preprocessor">#if defined(NO_PEXT)</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>  uint64_t index = <a class="code hl_variable" href="syzygy_8cc.html#a10beb4bd4f698799676f49c292153bb5">pieces</a>.as_int() &amp; bishop_magic_params[square].mask_;</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>  index *= bishop_magic_params[square].magic_number_;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>  index &gt;&gt;= bishop_magic_params[square].shift_bits_;</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>  uint64_t index =</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>      _pext_u64(<a class="code hl_variable" href="syzygy_8cc.html#a10beb4bd4f698799676f49c292153bb5">pieces</a>.as_int(), bishop_magic_params[square].mask_);</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span> </div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>  <span class="comment">// Return attacks bitboard.</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>  <span class="keywordflow">return</span> bishop_magic_params[square].attacks_table_[index];</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>}</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span> </div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>}  <span class="comment">// namespace</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span> </div>
<div class="foldopen" id="foldopen00413" data-start="{" data-end="}">
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno"><a class="line" href="namespacelczero.html#a9d23dd7ce7b52c2a4437775fdecad2a1">  413</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacelczero.html#a9d23dd7ce7b52c2a4437775fdecad2a1">InitializeMagicBitboards</a>() {</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span><span class="preprocessor">#if defined(NO_PEXT)</span></div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>  <span class="comment">// Set magic numbers for all board squares.</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> square = 0; square &lt; 64; square++) {</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    rook_magic_params[square].magic_number_ =</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>        kRookMagicNumbers[square].as_int();</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    bishop_magic_params[square].magic_number_ =</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>        kBishopMagicNumbers[square].as_int();</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>  }</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span> </div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>  <span class="comment">// Build attacks tables.</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>  BuildAttacksTable(rook_magic_params, rook_attacks_table, kRookDirections);</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>  BuildAttacksTable(bishop_magic_params, bishop_attacks_table,</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>                    kBishopDirections);</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>}</div>
</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span> </div>
<div class="foldopen" id="foldopen00430" data-start="{" data-end="}">
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#ad05bfccb4b65300ae770ea970e1be288">  430</a></span><a class="code hl_typedef" href="namespacelczero.html#aa171f8367781ec0e439fb73801bae029">MoveList</a> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#ad05bfccb4b65300ae770ea970e1be288">ChessBoard::GeneratePseudolegalMoves</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>  <a class="code hl_typedef" href="namespacelczero.html#aa171f8367781ec0e439fb73801bae029">MoveList</a> <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>;</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>  <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.reserve(60);</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> source : <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>) {</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    <span class="comment">// King</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    <span class="keywordflow">if</span> (source == <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>) {</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; delta : kKingMoves) {</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1Rank.html">Rank</a> dst_rank = source.rank() + delta.first;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        <span class="keywordflow">if</span> (!dst_rank.<a class="code hl_function" href="structlczero_1_1Rank.html#a413a5fe2c1738bdd468aaa41fc239a14">IsValid</a>()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1File.html">File</a> dst_file = source.file() + delta.second;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>        <span class="keywordflow">if</span> (!dst_file.<a class="code hl_function" href="structlczero_1_1File.html#a317da03d2cdba8b844de0aca6e1965a9">IsValid</a>()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>        <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> destination(dst_file, dst_rank);</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(destination)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a8e234d2282583ffdf00d96ffba951aa7">IsUnderAttack</a>(destination)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>        <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.emplace_back(<a class="code hl_function" href="classlczero_1_1Move.html#a4f4265b3d63caa54bf2e041b19568114">Move::White</a>(source, destination));</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>      }</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>      <span class="comment">// Castlings.</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>      <span class="keyword">auto</span> walk_free = [<span class="keyword">this</span>](<a class="code hl_struct" href="structlczero_1_1File.html">File</a> from, <a class="code hl_struct" href="structlczero_1_1File.html">File</a> to, <a class="code hl_struct" href="structlczero_1_1File.html">File</a> rook, <a class="code hl_struct" href="structlczero_1_1File.html">File</a> king) {</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>        <span class="keywordflow">for</span> (<a class="code hl_struct" href="structlczero_1_1File.html">File</a> i = from; i &lt;= to; ++i) {</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>          <span class="keywordflow">if</span> (i == rook || i == king) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>({i, kRank1}) || <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>({i, <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a>})) {</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>          }</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>        }</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>      };</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>      <span class="comment">// @From may be less or greater than @to. @To is not included in check</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>      <span class="comment">// unless it is the same with @from.</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>      <span class="keyword">auto</span> range_attacked = [<span class="keyword">this</span>](<a class="code hl_struct" href="structlczero_1_1File.html">File</a> from, <a class="code hl_struct" href="structlczero_1_1File.html">File</a> to) {</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>        <span class="keywordflow">if</span> (from == to) <span class="keywordflow">return</span> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a8e234d2282583ffdf00d96ffba951aa7">IsUnderAttack</a>(<a class="code hl_class" href="classlczero_1_1Square.html">Square</a>(from, <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a>));</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> increment = from &lt; to ? 1 : -1;</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>        <span class="keywordflow">while</span> (from != to) {</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>          <span class="keywordflow">if</span> (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a8e234d2282583ffdf00d96ffba951aa7">IsUnderAttack</a>(<a class="code hl_class" href="classlczero_1_1Square.html">Square</a>(from, <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a>))) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>          from += increment;</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>        }</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>      };</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>      <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1File.html">File</a> king = source.file();</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>      <span class="comment">// For castlings we don&#39;t check destination king square for checks, it</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>      <span class="comment">// will be done in legal move check phase.</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#af05cd4e30bfcb9d02eeaff8a2509e262">we_can_000</a>()) {</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1File.html">File</a> qrook = <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_variable" href="classlczero_1_1ChessBoard_1_1Castlings.html#a5e65efdefea109c2b313a2068e8d28b1">our_queenside_rook</a>;</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>        <span class="keywordflow">if</span> (walk_free(std::min(<a class="code hl_variable" href="namespacelczero.html#ab7917414c2cb7a3872ea8bfe4033b415">kFileC</a>, qrook), std::max(<a class="code hl_variable" href="namespacelczero.html#aaa588977c472aff4f9d7587bf81765bc">kFileD</a>, king), qrook,</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>                      king) &amp;&amp;</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>            !range_attacked(king, <a class="code hl_variable" href="namespacelczero.html#ab7917414c2cb7a3872ea8bfe4033b415">kFileC</a>)) {</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>          <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.emplace_back(<a class="code hl_function" href="classlczero_1_1Move.html#ae7391dab4225a5a361479a1b291dce01">Move::WhiteCastling</a>(king, qrook));</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>        }</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>      }</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#a09a5166ab6c7c3ecdb6427ac31e4911b">we_can_00</a>()) {</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1File.html">File</a> krook = <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_variable" href="classlczero_1_1ChessBoard_1_1Castlings.html#a36d5ef6b4187636c58790166511ed7cc">our_kingside_rook</a>;</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>        <span class="keywordflow">if</span> (walk_free(std::min(<a class="code hl_variable" href="namespacelczero.html#afa63614e6711e9ebb99a3e23266c59f1">kFileF</a>, king), std::max(<a class="code hl_variable" href="namespacelczero.html#a35faeebcefe15cd6f886ab393b90aa6a">kFileG</a>, krook), krook,</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>                      king) &amp;&amp;</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>            !range_attacked(king, <a class="code hl_variable" href="namespacelczero.html#a35faeebcefe15cd6f886ab393b90aa6a">kFileG</a>)) {</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>          <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.emplace_back(<a class="code hl_function" href="classlczero_1_1Move.html#ae7391dab4225a5a361479a1b291dce01">Move::WhiteCastling</a>(king, krook));</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>        }</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>      }</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>    }</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    <span class="keywordtype">bool</span> processed_piece = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    <span class="comment">// Rook (and queen)</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(source)) {</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>      processed_piece = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>      <a class="code hl_class" href="classlczero_1_1BitBoard.html">BitBoard</a> attacked =</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>          GetRookAttacks(source, <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a> | <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>) - <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>;</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span> </div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; destination : attacked) {</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>        <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.emplace_back(<a class="code hl_function" href="classlczero_1_1Move.html#a4f4265b3d63caa54bf2e041b19568114">Move::White</a>(source, destination));</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>      }</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    }</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>    <span class="comment">// Bishop (and queen)</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(source)) {</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>      processed_piece = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>      <a class="code hl_class" href="classlczero_1_1BitBoard.html">BitBoard</a> attacked =</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>          GetBishopAttacks(source, <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a> | <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>) - <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>;</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span> </div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; destination : attacked) {</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>        <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.emplace_back(<a class="code hl_function" href="classlczero_1_1Move.html#a4f4265b3d63caa54bf2e041b19568114">Move::White</a>(source, destination));</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>      }</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    }</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    <span class="keywordflow">if</span> (processed_piece) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>    <span class="comment">// Pawns.</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a> &amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aecd6a3874def234ec0244942531a2793">kPawnMask</a>).get(source)) {</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>      <span class="comment">// Moves forward.</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>      {</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1Rank.html">Rank</a> dst_rank = source.rank() + 1;</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1File.html">File</a> dst_file = source.file();</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>        <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> destination(dst_file, dst_rank);</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span> </div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(destination) &amp;&amp; !<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(destination)) {</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>          <span class="keywordflow">if</span> (dst_rank != <a class="code hl_variable" href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">kRank8</a>) {</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>            <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.emplace_back(<a class="code hl_function" href="classlczero_1_1Move.html#a4f4265b3d63caa54bf2e041b19568114">Move::White</a>(source, destination));</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>            <span class="keywordflow">if</span> (dst_rank == <a class="code hl_variable" href="namespacelczero.html#a5ea88ee0fd79db239cdaf230f834375a">kRank3</a>) {</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>              <span class="comment">// Maybe it&#39;ll be possible to move two squares.</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>              <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> jump_dst(dst_file, <a class="code hl_variable" href="namespacelczero.html#a37a270956e892e67994b41422eff48fd">kRank4</a>);</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>              <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(jump_dst) &amp;&amp; !<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(jump_dst)) {</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>                <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.emplace_back(<a class="code hl_function" href="classlczero_1_1Move.html#a4f4265b3d63caa54bf2e041b19568114">Move::White</a>(source, jump_dst));</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>              }</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>            }</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>            <span class="comment">// Promotions</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> promotion : kPromotions) {</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>              <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.emplace_back(</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>                  <a class="code hl_function" href="classlczero_1_1Move.html#ab971f0e995e2de029b82a086c3c9aa97">Move::WhitePromotion</a>(source, destination, promotion));</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>            }</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>          }</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>        }</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>      }</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>      <span class="comment">// Captures.</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>      {</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> direction : {-1, 1}) {</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>          <span class="keyword">const</span> <span class="keyword">auto</span> dst_rank = source.rank() + 1;</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>          <span class="keyword">const</span> <span class="keyword">auto</span> dst_file = source.file() + direction;</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>          <span class="keywordflow">if</span> (!dst_file.IsValid()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>          <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> destination(dst_file, dst_rank);</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(destination)) {</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>            <span class="keywordflow">if</span> (dst_rank == <a class="code hl_variable" href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">kRank8</a>) {</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>              <span class="comment">// Promotion.</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>              <span class="keywordflow">for</span> (<span class="keyword">auto</span> promotion : kPromotions) {</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>                <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.emplace_back(</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>                    <a class="code hl_function" href="classlczero_1_1Move.html#ab971f0e995e2de029b82a086c3c9aa97">Move::WhitePromotion</a>(source, destination, promotion));</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>              }</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>              <span class="comment">// Ordinary capture.</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>              <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.emplace_back(<a class="code hl_function" href="classlczero_1_1Move.html#a4f4265b3d63caa54bf2e041b19568114">Move::White</a>(source, destination));</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>            }</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dst_rank == <a class="code hl_variable" href="namespacelczero.html#a6b88338029954ece6a181e1adbf63dd3">kRank6</a> &amp;&amp;</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>                     <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(<a class="code hl_class" href="classlczero_1_1Square.html">Square</a>(dst_file, <a class="code hl_variable" href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">kRank8</a>))) {</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>            <span class="comment">// En passant.</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>            <span class="comment">// &quot;Pawn&quot; on opponent&#39;s file 8 means that en passant is possible.</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>            <span class="comment">// Those fake pawns are reset in ApplyMove.</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>            <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.emplace_back(<a class="code hl_function" href="classlczero_1_1Move.html#a5eee1ccc3a2abb902b418d3f10e4c3d2">Move::WhiteEnPassant</a>(source, destination));</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>          }</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        }</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>      }</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    }</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>    <span class="comment">// Knight.</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>    {</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> destination :</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>           kKnightAttacks[source.as_idx()] - <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>) {</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>        <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.emplace_back(<a class="code hl_function" href="classlczero_1_1Move.html#a4f4265b3d63caa54bf2e041b19568114">Move::White</a>(source, destination));</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>      }</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    }</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>  }</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>;</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>}  <span class="comment">// namespace lczero</span></div>
</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span> </div>
<div class="foldopen" id="foldopen00577" data-start="{" data-end="}">
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#ae7ae4e6378972211390dd6ff4d7698f3">  577</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#ae7ae4e6378972211390dd6ff4d7698f3">ChessBoard::IsValid</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>  <span class="keyword">const</span> <span class="keyword">auto</span> all = <a class="code hl_function" href="classlczero_1_1ChessBoard.html#ac74c92c22299c3332550032e114c5ed4">ours</a>() | <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a>();</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>  <span class="keyword">auto</span> check = all | <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a4ff6ab258621e94fb4dff398d3a9c27d">pawns</a>() | <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a639fe9f9322150c557a78aae4f7e2b40">bishops</a>() | <a class="code hl_function" href="classlczero_1_1ChessBoard.html#ab3dac08b8fd24e8a1a8276af8f2fd975">rooks</a>() | <a class="code hl_function" href="classlczero_1_1ChessBoard.html#af1cf4f04db5f12c6e14c509127456443">queens</a>() | <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a45bae22afa3ecc26233763bbdc577cec">kings</a>();</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>  <span class="keywordflow">if</span> (check != all ||</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>      (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a4ff6ab258621e94fb4dff398d3a9c27d">pawns</a>() &amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a639fe9f9322150c557a78aae4f7e2b40">bishops</a>()).as_int() ||</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>      (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a4ff6ab258621e94fb4dff398d3a9c27d">pawns</a>() &amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#ab3dac08b8fd24e8a1a8276af8f2fd975">rooks</a>()).as_int() ||</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>      (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a4ff6ab258621e94fb4dff398d3a9c27d">pawns</a>() &amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#af1cf4f04db5f12c6e14c509127456443">queens</a>()).as_int() ||</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>      (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a4ff6ab258621e94fb4dff398d3a9c27d">pawns</a>() &amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a45bae22afa3ecc26233763bbdc577cec">kings</a>()).as_int() ||</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>      (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a639fe9f9322150c557a78aae4f7e2b40">bishops</a>() &amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#ab3dac08b8fd24e8a1a8276af8f2fd975">rooks</a>()).as_int() ||</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>      (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a639fe9f9322150c557a78aae4f7e2b40">bishops</a>() &amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#af1cf4f04db5f12c6e14c509127456443">queens</a>()).as_int() ||</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>      (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a639fe9f9322150c557a78aae4f7e2b40">bishops</a>() &amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a45bae22afa3ecc26233763bbdc577cec">kings</a>()).as_int() ||</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>      (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#ab3dac08b8fd24e8a1a8276af8f2fd975">rooks</a>() &amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#af1cf4f04db5f12c6e14c509127456443">queens</a>()).as_int() ||</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>      (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#ab3dac08b8fd24e8a1a8276af8f2fd975">rooks</a>() &amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a45bae22afa3ecc26233763bbdc577cec">kings</a>()).as_int() ||</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>      (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#af1cf4f04db5f12c6e14c509127456443">queens</a>() &amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a45bae22afa3ecc26233763bbdc577cec">kings</a>()).as_int()) {</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>  }</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>}</div>
</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span> </div>
<div class="foldopen" id="foldopen00596" data-start="{" data-end="}">
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#ab24b2476e34ef43596501ac717832fb3">  596</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#ab24b2476e34ef43596501ac717832fb3">ChessBoard::ApplyMove</a>(<a class="code hl_class" href="classlczero_1_1Move.html">Move</a> move) {</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>  assert(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#acbf14a35154c37d0138324d666387df9">intersects</a>(<a class="code hl_function" href="classlczero_1_1BitBoard.html#afdcbdf9e0887c6950ab163297429440b">BitBoard::FromSquare</a>(move.<a class="code hl_function" href="classlczero_1_1Move.html#acfd7dffa1ee25335cdf6d491c0234d07">from</a>())));</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>  absl::Cleanup validate = [&amp;] {</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classlczero_1_1ChessBoard.html#ae7ae4e6378972211390dd6ff4d7698f3">IsValid</a>()) {</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>      <a class="code hl_define" href="logging_8h.html#a176c0577baa96c686397bca42f7ee6ff">CERR</a> &lt;&lt; <span class="stringliteral">&quot;Move &quot;</span> + move.<a class="code hl_function" href="classlczero_1_1Move.html#a064296c9a78c5137b8b78287cb2f1dcd">ToString</a>(<span class="keyword">true</span>) +</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>                  <span class="stringliteral">&quot; resulted in invalid board: &quot;</span> + <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a6d5d9ba8280cdf1ed963500f0b317145">DebugString</a>();</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>      assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>    }</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>  };</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>  <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1Square.html">Square</a>&amp; from = move.<a class="code hl_function" href="classlczero_1_1Move.html#acfd7dffa1ee25335cdf6d491c0234d07">from</a>();</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>  <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1Square.html">Square</a>&amp; to = move.<a class="code hl_function" href="classlczero_1_1Move.html#a32942da77fed0a1c88b139634355bcde">to</a>();</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1Rank.html">Rank</a> from_rank = from.<a class="code hl_function" href="classlczero_1_1Square.html#a4a0426f2a21efdb8e2523ed453496711">rank</a>();</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1File.html">File</a> from_file = from.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>();</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1Rank.html">Rank</a> to_rank = to.<a class="code hl_function" href="classlczero_1_1Square.html#a4a0426f2a21efdb8e2523ed453496711">rank</a>();</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1File.html">File</a> to_file = to.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>();</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span> </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>  <span class="comment">// Castlings.</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>  <span class="keywordflow">if</span> (from == <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>) {</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>    <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#a063e7eaeb8e09e792560a0bfdfe74e05">reset_we_can_00</a>();</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#a85d49d6f76b28ff23c8b41624a841a78">reset_we_can_000</a>();</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>    <span class="keyword">auto</span> do_castling = [<span class="keyword">this</span>](<a class="code hl_struct" href="structlczero_1_1File.html">File</a> king_dst, <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> rook_src, <a class="code hl_struct" href="structlczero_1_1File.html">File</a> rook_dst) {</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>      <span class="comment">// Remove en passant flags.</span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a> &amp;= <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aecd6a3874def234ec0244942531a2793">kPawnMask</a>;</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>);</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(rook_src);</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(rook_src);</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a> = <a class="code hl_class" href="classlczero_1_1Square.html">Square</a>(king_dst, <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a>);</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>);</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>      <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> rook_dst_sq(rook_dst, <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a>);</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(rook_dst_sq);</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(rook_dst_sq);</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>    };</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    <span class="keywordflow">if</span> (move.<a class="code hl_function" href="classlczero_1_1Move.html#afded3aeade40113e162a38065acce4ec">is_castling</a>()) {</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>      <span class="comment">// Castling.</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>      <span class="keywordflow">if</span> (to_file &gt; from_file) {</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        <span class="comment">// Kingside.</span></div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        do_castling(<a class="code hl_variable" href="namespacelczero.html#a35faeebcefe15cd6f886ab393b90aa6a">kFileG</a>, to, <a class="code hl_variable" href="namespacelczero.html#afa63614e6711e9ebb99a3e23266c59f1">kFileF</a>);</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>        <span class="comment">// Queenside.</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>        do_castling(<a class="code hl_variable" href="namespacelczero.html#ab7917414c2cb7a3872ea8bfe4033b415">kFileC</a>, to, <a class="code hl_variable" href="namespacelczero.html#aaa588977c472aff4f9d7587bf81765bc">kFileD</a>);</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>      }</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>    }</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>  }</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span> </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>  <span class="comment">// Move in our pieces.</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(from);</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(to);</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span> </div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>  <span class="comment">// Remove captured piece.</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>  <span class="keywordtype">bool</span> reset_50_moves = <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(to);</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>  <span class="keywordflow">if</span> (reset_50_moves) {</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(to);</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>    <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(to);</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>    <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(to);</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>    <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(to);</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>    <span class="keywordflow">if</span> (to == <a class="code hl_class" href="classlczero_1_1Square.html">Square</a>(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_variable" href="classlczero_1_1ChessBoard_1_1Castlings.html#a83e6b5a221d87d78bd04fb8f7713e2a8">their_kingside_rook</a>, <a class="code hl_variable" href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">kRank8</a>)) {</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#adcde95a0c7f868073369cfd4c062f7fc">reset_they_can_00</a>();</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>    }</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    <span class="keywordflow">if</span> (to == <a class="code hl_class" href="classlczero_1_1Square.html">Square</a>(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_variable" href="classlczero_1_1ChessBoard_1_1Castlings.html#ac7afa6bf3f54171cb2404b6870e6d079">their_queenside_rook</a>, <a class="code hl_variable" href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">kRank8</a>)) {</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#aece3daeb188fdab98565252cc7681721">reset_they_can_000</a>();</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>    }</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>  }</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span> </div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>  <span class="comment">// En passant.</span></div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>  <span class="keywordflow">if</span> (move.<a class="code hl_function" href="classlczero_1_1Move.html#a46024d874c08594f7fdb96d4e7cae4a4">is_en_passant</a>()) {</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>    <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> ep_pawn(to_file, <a class="code hl_variable" href="namespacelczero.html#a5b8bc88442fbb44b95cef7cfc0714a2a">kRank5</a>);</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>    <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(ep_pawn);</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>    <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(ep_pawn);</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>  }</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span> </div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>  <span class="comment">// Remove en passant flags.</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a> &amp;= <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aecd6a3874def234ec0244942531a2793">kPawnMask</a>;</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span> </div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>  <span class="comment">// If pawn was moved, reset 50 move draw counter.</span></div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>  reset_50_moves |= <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(from);</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span> </div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>  <span class="comment">// King, non-castling move</span></div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>  <span class="keywordflow">if</span> (from == <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>) {</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>    <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a> = to;</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>    <span class="keywordflow">return</span> reset_50_moves;</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>  }</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span> </div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>  <span class="comment">// Promotion.</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>  <span class="keywordflow">if</span> (move.<a class="code hl_function" href="classlczero_1_1Move.html#a44027392ace0f2aab156ded6db79bb88">is_promotion</a>()) {</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>    <span class="keywordflow">switch</span> (move.<a class="code hl_function" href="classlczero_1_1Move.html#aa1f8647a227fb3fd8086d69aeae65d87">promotion</a>().<a class="code hl_variable" href="structlczero_1_1PieceType.html#a4a19f318706380e3bc0194850f2c3382">idx</a>) {</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>      <span class="keywordflow">case</span> <a class="code hl_variable" href="namespacelczero.html#aedde9b45c7086de9aa43eaed7d6e3ba1">kRook</a>.<a class="code hl_variable" href="structlczero_1_1PieceType.html#a4a19f318706380e3bc0194850f2c3382">idx</a>:</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>        <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(to);</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>      <span class="keywordflow">case</span> <a class="code hl_variable" href="namespacelczero.html#a96f1f63d9271a0f81b3c94acb93b3d99">kBishop</a>.<a class="code hl_variable" href="structlczero_1_1PieceType.html#a4a19f318706380e3bc0194850f2c3382">idx</a>:</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>        <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(to);</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>      <span class="keywordflow">case</span> <a class="code hl_variable" href="namespacelczero.html#a1217b167970921dc66f9c7d134e07931">kQueen</a>.<a class="code hl_variable" href="structlczero_1_1PieceType.html#a4a19f318706380e3bc0194850f2c3382">idx</a>:</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>        <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(to);</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>        <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(to);</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>      <span class="keywordflow">default</span>:;</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>    }</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>    <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(from);</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>  }</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span> </div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>  <span class="comment">// Reset castling rights.</span></div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>  <span class="keywordflow">if</span> (from_rank == <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a> &amp;&amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(from)) {</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>    <span class="keywordflow">if</span> (from_file == <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_variable" href="classlczero_1_1ChessBoard_1_1Castlings.html#a5e65efdefea109c2b313a2068e8d28b1">our_queenside_rook</a>) {</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#a85d49d6f76b28ff23c8b41624a841a78">reset_we_can_000</a>();</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>    }</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>    <span class="keywordflow">if</span> (from_file == <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_variable" href="classlczero_1_1ChessBoard_1_1Castlings.html#a36d5ef6b4187636c58790166511ed7cc">our_kingside_rook</a>) {</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#a063e7eaeb8e09e792560a0bfdfe74e05">reset_we_can_00</a>();</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>    }</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>  }</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span> </div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>  <span class="comment">// Ordinary move.</span></div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a971d09a5d2d09cf2e1f34af13b059fda">set_if</a>(to, <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(from));</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a971d09a5d2d09cf2e1f34af13b059fda">set_if</a>(to, <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(from));</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a971d09a5d2d09cf2e1f34af13b059fda">set_if</a>(to, <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(from));</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(from);</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(from);</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>  <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">reset</a>(from);</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span> </div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>  <span class="comment">// Set en passant flag.</span></div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>  <span class="keywordflow">if</span> (to_rank - from_rank == 2 &amp;&amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(to)) {</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>    <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> ep_sq(to_file, to_rank - 1);</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>    <span class="keywordflow">if</span> (kPawnAttacks[ep_sq.<a class="code hl_function" href="classlczero_1_1Square.html#a1be93b90eff22449c4a4a003b3ac2b99">as_idx</a>()].intersects(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a> &amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>)) {</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>      <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(<a class="code hl_class" href="classlczero_1_1Square.html">Square</a>(to_file, <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a>));</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>    }</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>  }</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>  <span class="keywordflow">return</span> reset_50_moves;</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>}</div>
</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span> </div>
<div class="foldopen" id="foldopen00728" data-start="{" data-end="}">
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#a8e234d2282583ffdf00d96ffba951aa7">  728</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a8e234d2282583ffdf00d96ffba951aa7">ChessBoard::IsUnderAttack</a>(<a class="code hl_class" href="classlczero_1_1Square.html">Square</a> square)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1Rank.html">Rank</a> rank = square.<a class="code hl_function" href="classlczero_1_1Square.html#a4a0426f2a21efdb8e2523ed453496711">rank</a>();</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1File.html">File</a> file = square.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>();</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>  <span class="comment">// Check king.</span></div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>  {</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1Rank.html">Rank</a> krank = <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac3cb53799c242f72362f540ad77a4df9">their_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a4a0426f2a21efdb8e2523ed453496711">rank</a>();</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1File.html">File</a> kfile = <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac3cb53799c242f72362f540ad77a4df9">their_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>();</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    <span class="keywordflow">if</span> (std::abs(krank - rank) &lt;= 1 &amp;&amp; std::abs(kfile - file) &lt;= 1) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>  }</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>  <span class="comment">// Check rooks (and queens).</span></div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>  <span class="keywordflow">if</span> (GetRookAttacks(square, <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a> | <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>)</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>          .intersects(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a> &amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>)) {</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>  }</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>  <span class="comment">// Check bishops.</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>  <span class="keywordflow">if</span> (GetBishopAttacks(square, <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a> | <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>)</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>          .intersects(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a> &amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>)) {</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>  }</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>  <span class="comment">// Check pawns.</span></div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>  <span class="keywordflow">if</span> (kPawnAttacks[square.<a class="code hl_function" href="classlczero_1_1Square.html#a1be93b90eff22449c4a4a003b3ac2b99">as_idx</a>()].intersects(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a> &amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>)) {</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>  }</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>  <span class="comment">// Check knights.</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>  {</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    <span class="keywordflow">if</span> (kKnightAttacks[square.<a class="code hl_function" href="classlczero_1_1Square.html#a1be93b90eff22449c4a4a003b3ac2b99">as_idx</a>()].intersects(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a> - <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac3cb53799c242f72362f540ad77a4df9">their_king_</a> -</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>                                                   <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a> - <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a> -</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>                                                   (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a> &amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aecd6a3874def234ec0244942531a2793">kPawnMask</a>))) {</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>    }</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>  }</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>}</div>
</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span> </div>
<div class="foldopen" id="foldopen00762" data-start="{" data-end="}">
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#afde6f038fa4b9d5c6f12c332ec5e557a">  762</a></span><a class="code hl_class" href="classlczero_1_1KingAttackInfo.html">KingAttackInfo</a> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#afde6f038fa4b9d5c6f12c332ec5e557a">ChessBoard::GenerateKingAttackInfo</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>  <a class="code hl_class" href="classlczero_1_1KingAttackInfo.html">KingAttackInfo</a> king_attack_info;</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span> </div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>  <span class="comment">// Number of attackers that give check (used for double check detection).</span></div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>  <span class="keywordtype">unsigned</span> num_king_attackers = 0;</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span> </div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> row = <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a4a0426f2a21efdb8e2523ed453496711">rank</a>().<a class="code hl_variable" href="structlczero_1_1Rank.html#a741b063b4b071d67b1d576155b4a857c">idx</a>;</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> col = <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>().<a class="code hl_variable" href="structlczero_1_1File.html#aab3b81595c3ed161d8053ad8b91a5b0b">idx</a>;</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>  <span class="comment">// King checks are unnecessary, as kings cannot give check.</span></div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>  <span class="comment">// Check rooks (and queens).</span></div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>  <span class="keywordflow">if</span> (kRookAttacks[<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a1be93b90eff22449c4a4a003b3ac2b99">as_idx</a>()].intersects(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a> &amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>)) {</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; direction : kRookDirections) {</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>      <span class="keyword">auto</span> dst_row = row;</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>      <span class="keyword">auto</span> dst_col = col;</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>      <a class="code hl_class" href="classlczero_1_1BitBoard.html">BitBoard</a> attack_line(0);</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>      <span class="keywordtype">bool</span> possible_pinned_piece_found = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>      <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> possible_pinned_piece;</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>      <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>        dst_row += direction.first;</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>        dst_col += direction.second;</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>        <span class="keywordflow">if</span> (!IsOnBoard(dst_row, dst_col)) <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>        <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> destination(<a class="code hl_function" href="structlczero_1_1File.html#ab99e72565a1274701e4457b4228464ca">File::FromIdx</a>(dst_col),</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>                                 <a class="code hl_function" href="structlczero_1_1Rank.html#aeb6a8e026c4f15d6e56f19090ad374c6">Rank::FromIdx</a>(dst_row));</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(destination)) {</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>          <span class="keywordflow">if</span> (possible_pinned_piece_found) {</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>            <span class="comment">// No pieces pinned.</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>            <span class="comment">// This is a possible pinned piece.</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>            possible_pinned_piece_found = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>            possible_pinned_piece = destination;</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>          }</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>        }</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>        <span class="keywordflow">if</span> (!possible_pinned_piece_found) {</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>          attack_line.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(destination);</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>        }</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(destination)) {</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(destination)) {</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>            <span class="keywordflow">if</span> (possible_pinned_piece_found) {</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>              <span class="comment">// Store the pinned piece.</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>              king_attack_info.<a class="code hl_variable" href="classlczero_1_1KingAttackInfo.html#a4b516e8b7fde5c512a051bd42ee6880c">pinned_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(possible_pinned_piece);</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>              <span class="comment">// Update attack lines.</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>              king_attack_info.<a class="code hl_variable" href="classlczero_1_1KingAttackInfo.html#a3a58a8b7075a7cb67264454d64823029">attack_lines_</a> =</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>                  king_attack_info.<a class="code hl_variable" href="classlczero_1_1KingAttackInfo.html#a3a58a8b7075a7cb67264454d64823029">attack_lines_</a> | attack_line;</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>              num_king_attackers++;</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>            }</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>          }</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>        }</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>      }</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>    }</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>  }</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>  <span class="comment">// Check bishops.</span></div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>  <span class="keywordflow">if</span> (kBishopAttacks[<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a1be93b90eff22449c4a4a003b3ac2b99">as_idx</a>()].intersects(<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a> &amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>)) {</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; direction : kBishopDirections) {</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>      <span class="keyword">auto</span> dst_row = row;</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>      <span class="keyword">auto</span> dst_col = col;</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>      <a class="code hl_class" href="classlczero_1_1BitBoard.html">BitBoard</a> attack_line(0);</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>      <span class="keywordtype">bool</span> possible_pinned_piece_found = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>      <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> possible_pinned_piece;</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>      <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>        dst_row += direction.first;</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>        dst_col += direction.second;</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>        <span class="keywordflow">if</span> (!IsOnBoard(dst_row, dst_col)) <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>        <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> destination(<a class="code hl_function" href="structlczero_1_1File.html#ab99e72565a1274701e4457b4228464ca">File::FromIdx</a>(dst_col),</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>                                 <a class="code hl_function" href="structlczero_1_1Rank.html#aeb6a8e026c4f15d6e56f19090ad374c6">Rank::FromIdx</a>(dst_row));</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(destination)) {</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>          <span class="keywordflow">if</span> (possible_pinned_piece_found) {</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>            <span class="comment">// No pieces pinned.</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>            <span class="comment">// This is a possible pinned piece.</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>            possible_pinned_piece_found = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>            possible_pinned_piece = destination;</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>          }</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>        }</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>        <span class="keywordflow">if</span> (!possible_pinned_piece_found) {</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>          attack_line.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(destination);</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>        }</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(destination)) {</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(destination)) {</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>            <span class="keywordflow">if</span> (possible_pinned_piece_found) {</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>              <span class="comment">// Store the pinned piece.</span></div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>              king_attack_info.<a class="code hl_variable" href="classlczero_1_1KingAttackInfo.html#a4b516e8b7fde5c512a051bd42ee6880c">pinned_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(possible_pinned_piece);</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>              <span class="comment">// Update attack lines.</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>              king_attack_info.<a class="code hl_variable" href="classlczero_1_1KingAttackInfo.html#a3a58a8b7075a7cb67264454d64823029">attack_lines_</a> =</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>                  king_attack_info.<a class="code hl_variable" href="classlczero_1_1KingAttackInfo.html#a3a58a8b7075a7cb67264454d64823029">attack_lines_</a> | attack_line;</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>              num_king_attackers++;</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>            }</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>          }</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>        }</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>      }</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>    }</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>  }</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>  <span class="comment">// Check pawns.</span></div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>  <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1BitBoard.html">BitBoard</a> attacking_pawns =</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>      kPawnAttacks[<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a1be93b90eff22449c4a4a003b3ac2b99">as_idx</a>()] &amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a> &amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>;</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>  king_attack_info.<a class="code hl_variable" href="classlczero_1_1KingAttackInfo.html#a3a58a8b7075a7cb67264454d64823029">attack_lines_</a> =</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>      king_attack_info.<a class="code hl_variable" href="classlczero_1_1KingAttackInfo.html#a3a58a8b7075a7cb67264454d64823029">attack_lines_</a> | attacking_pawns;</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span> </div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>  <span class="keywordflow">if</span> (attacking_pawns.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abfa0d6cca4385dc2f6e7524f68b56694">as_int</a>()) {</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>    <span class="comment">// No more than one pawn can give check.</span></div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>    num_king_attackers++;</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>  }</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span> </div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>  <span class="comment">// Check knights.</span></div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>  <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1BitBoard.html">BitBoard</a> attacking_knights =</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>      kKnightAttacks[<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a1be93b90eff22449c4a4a003b3ac2b99">as_idx</a>()] &amp;</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>      (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a> - <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac3cb53799c242f72362f540ad77a4df9">their_king_</a> - <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a> - <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a> - (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a> &amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aecd6a3874def234ec0244942531a2793">kPawnMask</a>));</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>  king_attack_info.<a class="code hl_variable" href="classlczero_1_1KingAttackInfo.html#a3a58a8b7075a7cb67264454d64823029">attack_lines_</a> =</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>      king_attack_info.<a class="code hl_variable" href="classlczero_1_1KingAttackInfo.html#a3a58a8b7075a7cb67264454d64823029">attack_lines_</a> | attacking_knights;</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span> </div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>  <span class="keywordflow">if</span> (attacking_knights.<a class="code hl_function" href="classlczero_1_1BitBoard.html#abfa0d6cca4385dc2f6e7524f68b56694">as_int</a>()) {</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>    <span class="comment">// No more than one knight can give check.</span></div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>    num_king_attackers++;</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>  }</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span> </div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>  assert(num_king_attackers &lt;= 2);</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>  king_attack_info.<a class="code hl_variable" href="classlczero_1_1KingAttackInfo.html#a19b9415cd785cb2cd556a2405f92ed1b">double_check_</a> = (num_king_attackers == 2);</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span> </div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>  <span class="keywordflow">return</span> king_attack_info;</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>}</div>
</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span> </div>
<div class="foldopen" id="foldopen00888" data-start="{" data-end="}">
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#ad09e84ee411b61f7245c148718c33786">  888</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#ad09e84ee411b61f7245c148718c33786">ChessBoard::IsLegalMove</a>(<a class="code hl_class" href="classlczero_1_1Move.html">Move</a> move,</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>                             <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1KingAttackInfo.html">KingAttackInfo</a>&amp; king_attack_info)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; from = move.<a class="code hl_function" href="classlczero_1_1Move.html#acfd7dffa1ee25335cdf6d491c0234d07">from</a>();</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; to = move.<a class="code hl_function" href="classlczero_1_1Move.html#a32942da77fed0a1c88b139634355bcde">to</a>();</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span> </div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>  <span class="comment">// En passant. Complex but rare. Just apply</span></div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>  <span class="comment">// and check that we are not under check.</span></div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>  <span class="keywordflow">if</span> (move.<a class="code hl_function" href="classlczero_1_1Move.html#a46024d874c08594f7fdb96d4e7cae4a4">is_en_passant</a>()) {</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>    <a class="code hl_class" href="classlczero_1_1ChessBoard.html">ChessBoard</a> board(*<span class="keyword">this</span>);</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>    board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#ab24b2476e34ef43596501ac717832fb3">ApplyMove</a>(move);</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>    <span class="keywordflow">return</span> !board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a3ac6e98b875aa545aad2509b5711a46c">IsUnderCheck</a>();</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>  }</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span> </div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>  <span class="comment">// Check if we are already under check.</span></div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>  <span class="keywordflow">if</span> (king_attack_info.<a class="code hl_function" href="classlczero_1_1KingAttackInfo.html#ae46a55a16ba312f0084bd3b4769723a4">in_check</a>()) {</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>    <span class="comment">// King move.</span></div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>    <span class="keywordflow">if</span> (from == <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>) {</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>      <span class="comment">// Just apply and check that we are not under check.</span></div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>      <a class="code hl_class" href="classlczero_1_1ChessBoard.html">ChessBoard</a> board(*<span class="keyword">this</span>);</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>      board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#ab24b2476e34ef43596501ac717832fb3">ApplyMove</a>(move);</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>      <span class="keywordflow">return</span> !board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a3ac6e98b875aa545aad2509b5711a46c">IsUnderCheck</a>();</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>    }</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span> </div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>    <span class="comment">// Pinned pieces can never resolve a check.</span></div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>    <span class="keywordflow">if</span> (king_attack_info.<a class="code hl_function" href="classlczero_1_1KingAttackInfo.html#a964313e5db7777c89b3115ca40d0fbc3">is_pinned</a>(from)) {</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>    }</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span> </div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>    <span class="comment">// The piece to move is no king and is not pinned.</span></div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>    <span class="keywordflow">if</span> (king_attack_info.<a class="code hl_function" href="classlczero_1_1KingAttackInfo.html#a807e500b1300f28fd33cf03dce54e0d7">in_double_check</a>()) {</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>      <span class="comment">// Only a king move can resolve the double check.</span></div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>      <span class="comment">// Only one attacking piece gives check.</span></div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>      <span class="comment">// Our piece is free to move (not pinned). Check if the attacker is</span></div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>      <span class="comment">// captured or interposed after the piece has moved to its destination</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>      <span class="comment">// square.</span></div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>      <span class="keywordflow">return</span> king_attack_info.<a class="code hl_function" href="classlczero_1_1KingAttackInfo.html#ac030be6020e8fb290ab792f057fccf40">is_on_attack_line</a>(to);</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>    }</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>  }</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span> </div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>  <span class="comment">// King moves.</span></div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>  <span class="keywordflow">if</span> (from == <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>) {</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>    <span class="keywordflow">if</span> (!move.<a class="code hl_function" href="classlczero_1_1Move.html#afded3aeade40113e162a38065acce4ec">is_castling</a>()) {</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>      <span class="comment">// Non-castling move. Already checked during movegen.</span></div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>    }</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>    <span class="comment">// Checking whether king is under check after castling.</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>    <a class="code hl_class" href="classlczero_1_1ChessBoard.html">ChessBoard</a> board(*<span class="keyword">this</span>);</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>    board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#ab24b2476e34ef43596501ac717832fb3">ApplyMove</a>(move);</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>    <span class="keywordflow">return</span> !board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a3ac6e98b875aa545aad2509b5711a46c">IsUnderCheck</a>();</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>  }</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span> </div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>  <span class="comment">// If we get here, we are not under check.</span></div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>  <span class="comment">// If the piece is not pinned, it is free to move anywhere.</span></div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>  <span class="keywordflow">if</span> (!king_attack_info.<a class="code hl_function" href="classlczero_1_1KingAttackInfo.html#a964313e5db7777c89b3115ca40d0fbc3">is_pinned</a>(from)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span> </div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>  <span class="comment">// The piece is pinned. Now check that it stays on the same line w.r.t. the</span></div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>  <span class="comment">// king.</span></div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> dx_from = from.file() - <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>();</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> dy_from = from.rank() - <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a4a0426f2a21efdb8e2523ed453496711">rank</a>();</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> dx_to = to.file() - <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>();</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> dy_to = to.rank() - <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a4a0426f2a21efdb8e2523ed453496711">rank</a>();</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span> </div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>  <span class="keywordflow">if</span> (dx_from == 0 || dx_to == 0) {</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>    <span class="keywordflow">return</span> (dx_from == dx_to);</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>    <span class="keywordflow">return</span> (dx_from * dy_to == dx_to * dy_from);</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>  }</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>}</div>
</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span> </div>
<div class="foldopen" id="foldopen00959" data-start="{" data-end="}">
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#a716eb4e4439e609928eb57ec4f4c7670">  959</a></span><a class="code hl_typedef" href="namespacelczero.html#aa171f8367781ec0e439fb73801bae029">MoveList</a> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a716eb4e4439e609928eb57ec4f4c7670">ChessBoard::GenerateLegalMoves</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>  <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1KingAttackInfo.html">KingAttackInfo</a> king_attack_info = <a class="code hl_function" href="classlczero_1_1ChessBoard.html#afde6f038fa4b9d5c6f12c332ec5e557a">GenerateKingAttackInfo</a>();</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>  <a class="code hl_typedef" href="namespacelczero.html#aa171f8367781ec0e439fb73801bae029">MoveList</a> <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a> = <a class="code hl_function" href="classlczero_1_1ChessBoard.html#ad05bfccb4b65300ae770ea970e1be288">GeneratePseudolegalMoves</a>();</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>  <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.erase(</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>      std::remove_if(<a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.begin(), <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.end(),</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>                     [&amp;](<a class="code hl_class" href="classlczero_1_1Move.html">Move</a> <a class="code hl_variable" href="memcache_8cc.html#ac51334f57ef8b81c0629c9421798c344">m</a>) { return !IsLegalMove(m, king_attack_info); }),</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>      <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>.end());</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>;</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>}</div>
</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span> </div>
<div class="foldopen" id="foldopen00969" data-start="{" data-end="}">
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#a1c677b922401c38a0b89df2cc61eb54a">  969</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a1c677b922401c38a0b89df2cc61eb54a">ChessBoard::PutPiece</a>(<a class="code hl_class" href="classlczero_1_1Square.html">Square</a> square, <a class="code hl_struct" href="structlczero_1_1PieceType.html">PieceType</a> piece, <span class="keywordtype">bool</span> is_theirs) {</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>  (is_theirs ? <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a> : <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>).set(square);</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>  <span class="keywordflow">if</span> (piece == <a class="code hl_variable" href="namespacelczero.html#a6c4ba6363db124cd8e0926a5c125d617">kKing</a>) (is_theirs ? <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac3cb53799c242f72362f540ad77a4df9">their_king_</a> : <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>) = square;</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>  <span class="keywordflow">if</span> (piece == <a class="code hl_variable" href="namespacelczero.html#acdcd78ca075856bd7968d322394b24ef">kPawn</a>) <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(square);</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>  <span class="keywordflow">if</span> (piece == <a class="code hl_variable" href="namespacelczero.html#aedde9b45c7086de9aa43eaed7d6e3ba1">kRook</a> || piece == <a class="code hl_variable" href="namespacelczero.html#a1217b167970921dc66f9c7d134e07931">kQueen</a>) <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(square);</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>  <span class="keywordflow">if</span> (piece == <a class="code hl_variable" href="namespacelczero.html#a96f1f63d9271a0f81b3c94acb93b3d99">kBishop</a> || piece == <a class="code hl_variable" href="namespacelczero.html#a1217b167970921dc66f9c7d134e07931">kQueen</a>) <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(square);</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>}</div>
</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span> </div>
<div class="foldopen" id="foldopen00977" data-start="{" data-end="}">
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#aa6d933726bfce835ecf7ce2b0094a63f">  977</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#aa6d933726bfce835ecf7ce2b0094a63f">ChessBoard::SetFromFen</a>(std::string_view <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>, <span class="keywordtype">int</span>* rule50_ply, <span class="keywordtype">int</span>* <a class="code hl_variable" href="rescorer_8cc.html#aec06c2e966f0428705af6846da419aaf">moves</a>) {</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>  <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a92cef3b5ecadb2db2f1f6cb693860a84">Clear</a>();</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>  <span class="keywordflow">if</span> (rule50_ply) *rule50_ply = 0;</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="rescorer_8cc.html#aec06c2e966f0428705af6846da419aaf">moves</a>) *<a class="code hl_variable" href="rescorer_8cc.html#aec06c2e966f0428705af6846da419aaf">moves</a> = 1;</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>  <a class="code hl_struct" href="structlczero_1_1Rank.html">Rank</a> rank = <a class="code hl_variable" href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">kRank8</a>;</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>  <a class="code hl_struct" href="structlczero_1_1File.html">File</a> file = <a class="code hl_variable" href="namespacelczero.html#a1f4ade4e159941c4938d8ce7283c7a78">kFileA</a>;</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>  <span class="keywordtype">size_t</span> pos = 0;</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span> </div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>  <span class="keyword">auto</span> complain = [&amp;](std::string_view msg) {</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>    <span class="keywordflow">throw</span> <a class="code hl_class" href="classlczero_1_1Exception.html">Exception</a>(<span class="stringliteral">&quot;Bad fen string (&quot;</span> + std::string(msg) +</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>                    <span class="stringliteral">&quot;): &quot;</span> + std::string(<a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>));</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>  };</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>  <span class="keyword">auto</span> skip_whitespace = [&amp;](std::string_view where = {}) {</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>    <span class="keywordflow">if</span> (!where.empty() &amp;&amp; pos &lt; <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>.size() &amp;&amp; <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>[pos] != <span class="charliteral">&#39; &#39;</span>) {</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>      complain(<span class="stringliteral">&quot;space expected &quot;</span> + std::string(where));</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>    }</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>    <span class="keywordflow">while</span> (pos &lt; <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>.size() &amp;&amp; <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>[pos] == <span class="charliteral">&#39; &#39;</span>) ++pos;</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>    <span class="keywordflow">return</span> pos == <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>.size();</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>  };</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span> </div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>  <span class="comment">// Skip leading whitespaces.</span></div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>  skip_whitespace();</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span> </div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>  <span class="comment">// Parse board position.</span></div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>  <span class="keywordflow">for</span> (; pos &lt; <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>.size(); ++pos) {</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> c = <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>[pos];</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>    <span class="keywordflow">if</span> (c == <span class="charliteral">&#39; &#39;</span>) <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>    <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>      <span class="keywordflow">if</span> (rank == <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a>) complain(<span class="stringliteral">&quot;too many ranks&quot;</span>);</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>      --rank;</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>      file = <a class="code hl_variable" href="namespacelczero.html#a1f4ade4e159941c4938d8ce7283c7a78">kFileA</a>;</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>    }</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>    <span class="keywordflow">if</span> (c &gt;= <span class="charliteral">&#39;1&#39;</span> &amp;&amp; c &lt;= <span class="charliteral">&#39;8&#39;</span>) {</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>      file += c - <span class="charliteral">&#39;0&#39;</span>;</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>      <span class="keywordflow">if</span> (file &gt; <a class="code hl_function" href="structlczero_1_1File.html#ab99e72565a1274701e4457b4228464ca">File::FromIdx</a>(8)) complain(<span class="stringliteral">&quot;too many files&quot;</span>);</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>    }</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>    <a class="code hl_struct" href="structlczero_1_1PieceType.html">PieceType</a> piece = <a class="code hl_function" href="structlczero_1_1PieceType.html#aaa8792338df7836291b9f4af82d8596f">PieceType::Parse</a>(c);</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>    <span class="keywordflow">if</span> (!piece.<a class="code hl_function" href="structlczero_1_1PieceType.html#ae7ca48aec5190b37d320f4dd5394d983">IsValid</a>()) complain(<span class="stringliteral">&quot;invalid character as piece&quot;</span>);</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>    <span class="keywordflow">if</span> (!file.<a class="code hl_function" href="structlczero_1_1File.html#a317da03d2cdba8b844de0aca6e1965a9">IsValid</a>() || !rank.<a class="code hl_function" href="structlczero_1_1Rank.html#a413a5fe2c1738bdd468aaa41fc239a14">IsValid</a>()) complain(<span class="stringliteral">&quot;piece out of board&quot;</span>);</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>    <span class="keywordflow">if</span> (piece == <a class="code hl_variable" href="namespacelczero.html#acdcd78ca075856bd7968d322394b24ef">kPawn</a> &amp;&amp; (rank == <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a> || rank == <a class="code hl_variable" href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">kRank8</a>)) {</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>      complain(<span class="stringliteral">&quot;pawn on back rank&quot;</span>);</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>    }</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>    <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a1c677b922401c38a0b89df2cc61eb54a">PutPiece</a>(<a class="code hl_class" href="classlczero_1_1Square.html">Square</a>(file, rank), piece, std::islower(c));</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>    ++file;</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>  }</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>  <span class="keywordflow">if</span> (skip_whitespace(<span class="stringliteral">&quot;after the board&quot;</span>)) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span> </div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>  <span class="comment">// Parsing side to move.</span></div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> side_to_move = std::tolower(<a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>[pos++]);</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>  <span class="keywordflow">if</span> (side_to_move == <span class="charliteral">&#39;b&#39;</span>) {</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>    <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a71f55c55d217e5948991d54017b083bb">Mirror</a>();</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (side_to_move != <span class="charliteral">&#39;w&#39;</span>) {</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>    complain(<span class="stringliteral">&quot;invalid side to move&quot;</span>);</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>  }</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>  <span class="keywordflow">if</span> (skip_whitespace(<span class="stringliteral">&quot;after side to move&quot;</span>)) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span> </div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>  <span class="comment">// Parse castling rights.</span></div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>[pos] == <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>    ++pos;</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>    <span class="keyword">auto</span> find_rook = [&amp;](<span class="keywordtype">bool</span> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a>, <span class="keywordtype">bool</span> kingside) -&gt; <a class="code hl_struct" href="structlczero_1_1File.html">File</a> {</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>      <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1Rank.html">Rank</a> rank = <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a> ? <a class="code hl_variable" href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">kRank8</a> : <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a>;</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>      <span class="keywordflow">for</span> (<a class="code hl_struct" href="structlczero_1_1File.html">File</a> file = kingside ? <a class="code hl_variable" href="namespacelczero.html#a136a9e0535b2b6f5c567564e677e8fd3">kFileH</a> : <a class="code hl_variable" href="namespacelczero.html#a1f4ade4e159941c4938d8ce7283c7a78">kFileA</a>;</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>           file != (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a> ? <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac3cb53799c242f72362f540ad77a4df9">their_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>() : <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>());</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>           kingside ? --file : ++file) {</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>        <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> sq(file, rank);</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="classlczero_1_1ChessBoard.html#ab3dac08b8fd24e8a1a8276af8f2fd975">rooks</a>().get(sq)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a> ? <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(sq) : <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(sq)) {</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>          <span class="keywordflow">return</span> file;</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>        }</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>      }</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>      complain(<span class="stringliteral">&quot;missing rook for castling&quot;</span>);</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacelczero.html#a1f4ade4e159941c4938d8ce7283c7a78">kFileA</a>;  <span class="comment">// Unreachable.</span></div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>    };</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>    <span class="keywordflow">for</span> (; pos &lt; <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>.size(); ++pos) {</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> c = <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>[pos];</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>      <span class="keywordflow">if</span> (c == <span class="charliteral">&#39; &#39;</span>) <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>      <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a> = bool(std::isupper(c)) == <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a712259c26bc9c44dbff0ab563a851c01">flipped</a>();</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>      <span class="keywordtype">bool</span> kingside = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>      <a class="code hl_struct" href="structlczero_1_1File.html">File</a> file;</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>      <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;K&#39;</span> || c == <span class="charliteral">&#39;Q&#39;</span> || c == <span class="charliteral">&#39;k&#39;</span> || c == <span class="charliteral">&#39;q&#39;</span>) {</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>        kingside = std::tolower(c) == <span class="charliteral">&#39;k&#39;</span>;</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>        file = find_rook(<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a>, kingside);</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>        file = <a class="code hl_function" href="structlczero_1_1File.html#ac09d8b0a57f7ce474de1740081101579">File::Parse</a>(c);</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>        <span class="keywordflow">if</span> (!file.<a class="code hl_function" href="structlczero_1_1File.html#a317da03d2cdba8b844de0aca6e1965a9">IsValid</a>()) complain(<span class="stringliteral">&quot;invalid character in castling&quot;</span>);</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>        kingside = file &gt; (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a> ? <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac3cb53799c242f72362f540ad77a4df9">their_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>() : <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a>.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>());</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>      }</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>      <span class="keywordflow">if</span> (kingside &amp;&amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a>) {</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>        <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#a747bebf8728dd8e2f39a28f842dc6ac4">set_they_can_00</a>();</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>        <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_variable" href="classlczero_1_1ChessBoard_1_1Castlings.html#a83e6b5a221d87d78bd04fb8f7713e2a8">their_kingside_rook</a> = file;</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (kingside &amp;&amp; !<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a>) {</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>        <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#a32dbd73e8129164c13705e6742f34722">set_we_can_00</a>();</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>        <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_variable" href="classlczero_1_1ChessBoard_1_1Castlings.html#a36d5ef6b4187636c58790166511ed7cc">our_kingside_rook</a> = file;</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!kingside &amp;&amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a>) {</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>        <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#a41f95c60973a3c73695e92cd04437285">set_they_can_000</a>();</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>        <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_variable" href="classlczero_1_1ChessBoard_1_1Castlings.html#ac7afa6bf3f54171cb2404b6870e6d079">their_queenside_rook</a> = file;</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!kingside &amp;&amp; !<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a>) {</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>        <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#adb0b639d544320169f162a3a62c426bb">set_we_can_000</a>();</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>        <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">castlings_</a>.<a class="code hl_variable" href="classlczero_1_1ChessBoard_1_1Castlings.html#a5e65efdefea109c2b313a2068e8d28b1">our_queenside_rook</a> = file;</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>      }</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>    }</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>  }</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>  <span class="keywordflow">if</span> (skip_whitespace(<span class="stringliteral">&quot;after castling&quot;</span>)) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span> </div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>  <span class="comment">// Parse en passant square.</span></div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>[pos] == <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>    ++pos;</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>    <span class="keywordflow">if</span> (pos + 2 &gt;= <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>.size()) complain(<span class="stringliteral">&quot;en passant square expected&quot;</span>);</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1File.html">File</a> file = <a class="code hl_function" href="structlczero_1_1File.html#ac09d8b0a57f7ce474de1740081101579">File::Parse</a>(<a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>[pos]);</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structlczero_1_1Rank.html">Rank</a> rank = <a class="code hl_function" href="structlczero_1_1Rank.html#ab6596ab3a18d0e90e300988237407c0a">Rank::Parse</a>(<a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>[pos + 1]);</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>    <span class="keywordflow">if</span> (!file.<a class="code hl_function" href="structlczero_1_1File.html#a317da03d2cdba8b844de0aca6e1965a9">IsValid</a>() || !rank.<a class="code hl_function" href="structlczero_1_1Rank.html#a413a5fe2c1738bdd468aaa41fc239a14">IsValid</a>()) complain(<span class="stringliteral">&quot;bad en passant square&quot;</span>);</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>    <span class="keywordflow">if</span> (rank != (<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a712259c26bc9c44dbff0ab563a851c01">flipped</a>() ? <a class="code hl_variable" href="namespacelczero.html#a5ea88ee0fd79db239cdaf230f834375a">kRank3</a> : <a class="code hl_variable" href="namespacelczero.html#a6b88338029954ece6a181e1adbf63dd3">kRank6</a>)) complain(<span class="stringliteral">&quot;bad en passant rank&quot;</span>);</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>    <span class="keywordflow">if</span> ((<a class="code hl_function" href="classlczero_1_1ChessBoard.html#ac74c92c22299c3332550032e114c5ed4">ours</a>() | <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a>()).get(<a class="code hl_class" href="classlczero_1_1Square.html">Square</a>(file, <a class="code hl_variable" href="namespacelczero.html#a6b88338029954ece6a181e1adbf63dd3">kRank6</a>))) {</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>      complain(<span class="stringliteral">&quot;en passant square occupied&quot;</span>);</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>    }</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>    <span class="keywordflow">if</span> (!(<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a>() &amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a4ff6ab258621e94fb4dff398d3a9c27d">pawns</a>()).get(<a class="code hl_class" href="classlczero_1_1Square.html">Square</a>(file, <a class="code hl_variable" href="namespacelczero.html#a5b8bc88442fbb44b95cef7cfc0714a2a">kRank5</a>))) {</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>      complain(<span class="stringliteral">&quot;no pawn to capture en passant&quot;</span>);</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>    }</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>    <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">set</a>(<a class="code hl_class" href="classlczero_1_1Square.html">Square</a>(file, <a class="code hl_variable" href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">kRank8</a>));</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>    pos += 2;</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>  }</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>  <span class="keywordflow">if</span> (skip_whitespace(<span class="stringliteral">&quot;after en passant&quot;</span>)) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span> </div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>  <span class="comment">// Parse rule 50 halfmoves.</span></div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>  <span class="keyword">auto</span> parse_int = [&amp;](<span class="keywordtype">int</span>* into, std::string_view error_msg) {</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>    <span class="keyword">const</span> std::string_view <a class="code hl_variable" href="syzygy_8cc.html#abea371f9030e15a5d2a4c181576833d8">num</a> = <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>.substr(pos, <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>.find(<span class="charliteral">&#39; &#39;</span>, pos) - pos);</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>    <span class="keywordtype">int</span> tmp;</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>    <span class="keyword">auto</span> res = std::from_chars(<a class="code hl_variable" href="syzygy_8cc.html#abea371f9030e15a5d2a4c181576833d8">num</a>.data(), <a class="code hl_variable" href="syzygy_8cc.html#abea371f9030e15a5d2a4c181576833d8">num</a>.data() + <a class="code hl_variable" href="syzygy_8cc.html#abea371f9030e15a5d2a4c181576833d8">num</a>.size(), tmp);</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>    <span class="keywordflow">if</span> (res.ec != std::errc()) complain(error_msg);</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>    <span class="keywordflow">if</span> (into) *into = tmp;</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>    pos += <a class="code hl_variable" href="syzygy_8cc.html#abea371f9030e15a5d2a4c181576833d8">num</a>.size();</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>  };</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>  parse_int(rule50_ply, <span class="stringliteral">&quot;bad rule 50 halfmoves&quot;</span>);</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>  <span class="keywordflow">if</span> (skip_whitespace(<span class="stringliteral">&quot;after rule-50 clock&quot;</span>)) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span> </div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>  <span class="comment">// Parse total moves.</span></div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>  parse_int(<a class="code hl_variable" href="rescorer_8cc.html#aec06c2e966f0428705af6846da419aaf">moves</a>, <span class="stringliteral">&quot;bad total moves&quot;</span>);</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>  <span class="keywordflow">if</span> (!skip_whitespace(<span class="stringliteral">&quot;after total moves&quot;</span>)) complain(<span class="stringliteral">&quot;extra characters&quot;</span>);</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>}</div>
</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span> </div>
<div class="foldopen" id="foldopen01121" data-start="{" data-end="}">
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#a7d970bc551931e66ee9c5923c827b1cf"> 1121</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a7d970bc551931e66ee9c5923c827b1cf">ChessBoard::HasMatingMaterial</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">rooks_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#ac5ab5710b6f8d85b21014ac1fff54484">empty</a>() || !<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#ac5ab5710b6f8d85b21014ac1fff54484">empty</a>()) {</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>  }</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span> </div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>  <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a> | <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>).count() &lt; 4) {</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>    <span class="comment">// K v K, K+B v K, K+N v K.</span></div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>  }</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>  <span class="keywordflow">if</span> (!(<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a0f21b051a004b0fba25071a9b07999bc">knights</a>().empty())) {</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>  }</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span> </div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>  <span class="comment">// Only kings and bishops remain.</span></div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span> </div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>  <span class="keyword">constexpr</span> <a class="code hl_class" href="classlczero_1_1BitBoard.html">BitBoard</a> kLightSquares(0x55AA55AA55AA55AAULL);</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>  <span class="keyword">constexpr</span> <a class="code hl_class" href="classlczero_1_1BitBoard.html">BitBoard</a> kDarkSquares(0xAA55AA55AA55AA55ULL);</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span> </div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> light_bishop = <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#acbf14a35154c37d0138324d666387df9">intersects</a>(kLightSquares);</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> dark_bishop = <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">bishops_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#acbf14a35154c37d0138324d666387df9">intersects</a>(kDarkSquares);</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>  <span class="keywordflow">return</span> light_bishop &amp;&amp; dark_bishop;</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>}</div>
</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span> </div>
<div class="foldopen" id="foldopen01144" data-start="{" data-end="}">
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#a6d5d9ba8280cdf1ed963500f0b317145"> 1144</a></span>std::string <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a6d5d9ba8280cdf1ed963500f0b317145">ChessBoard::DebugString</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a> = <a class="code hl_function" href="namespacelczero.html#a8452fa1da52ea13a4ecbe4bdaae64801">BoardToFen</a>(*<span class="keyword">this</span>);</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>  std::replace(<a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>.begin(), <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>.end(), <span class="charliteral">&#39; &#39;</span>, <span class="charliteral">&#39;_&#39;</span>);</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>  <span class="keywordflow">return</span> <span class="stringliteral">&quot;https://lc0.org/fen/&quot;</span> + <a class="code hl_variable" href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a>;</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>}</div>
</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span> </div>
<div class="foldopen" id="foldopen01150" data-start="{" data-end="}">
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"><a class="line" href="classlczero_1_1ChessBoard.html#a25a6ec4afd36ca8de6bc4f1b0e1cd302"> 1150</a></span><a class="code hl_class" href="classlczero_1_1Move.html">Move</a> <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a25a6ec4afd36ca8de6bc4f1b0e1cd302">ChessBoard::ParseMove</a>(std::string_view move_str)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>  <span class="keyword">auto</span> complain = [&amp;move_str](std::string_view reason) {</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>    <span class="keywordflow">throw</span> <a class="code hl_class" href="classlczero_1_1Exception.html">Exception</a>(<span class="stringliteral">&quot;Invalid move (&quot;</span> + std::string(reason) +</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>                    <span class="stringliteral">&quot;): &quot;</span> + std::string(move_str));</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>  };</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>  <span class="keywordflow">if</span> (move_str.size() &lt; 4 || move_str.size() &gt; 5) complain(<span class="stringliteral">&quot;wrong move size&quot;</span>);</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>  <a class="code hl_struct" href="structlczero_1_1File.html">File</a> from_file = <a class="code hl_function" href="structlczero_1_1File.html#ac09d8b0a57f7ce474de1740081101579">File::Parse</a>(move_str[0]);</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>  <a class="code hl_struct" href="structlczero_1_1Rank.html">Rank</a> from_rank = <a class="code hl_function" href="structlczero_1_1Rank.html#ab6596ab3a18d0e90e300988237407c0a">Rank::Parse</a>(move_str[1]);</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>  <a class="code hl_struct" href="structlczero_1_1File.html">File</a> to_file = <a class="code hl_function" href="structlczero_1_1File.html#ac09d8b0a57f7ce474de1740081101579">File::Parse</a>(move_str[2]);</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>  <a class="code hl_struct" href="structlczero_1_1Rank.html">Rank</a> to_rank = <a class="code hl_function" href="structlczero_1_1Rank.html#ab6596ab3a18d0e90e300988237407c0a">Rank::Parse</a>(move_str[3]);</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>  <span class="keywordflow">if</span> (!from_file.<a class="code hl_function" href="structlczero_1_1File.html#a317da03d2cdba8b844de0aca6e1965a9">IsValid</a>() || !from_rank.<a class="code hl_function" href="structlczero_1_1Rank.html#a413a5fe2c1738bdd468aaa41fc239a14">IsValid</a>() || !to_file.<a class="code hl_function" href="structlczero_1_1File.html#a317da03d2cdba8b844de0aca6e1965a9">IsValid</a>() ||</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>      !to_rank.<a class="code hl_function" href="structlczero_1_1Rank.html#a413a5fe2c1738bdd468aaa41fc239a14">IsValid</a>()) {</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>    complain(<span class="stringliteral">&quot;bad square&quot;</span>);</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>  }</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#afbbcac155ea7795b5288da2512516e14">flipped_</a>) {</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>    from_rank.<a class="code hl_function" href="structlczero_1_1Rank.html#a63044bd97cfe77ba65f8eaf911785b10">Flip</a>();</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>    to_rank.<a class="code hl_function" href="structlczero_1_1Rank.html#a63044bd97cfe77ba65f8eaf911785b10">Flip</a>();</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>  }</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>  <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> from(from_file, from_rank);</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>  <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> to(to_file, to_rank);</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(from)) complain(<span class="stringliteral">&quot;no piece to move&quot;</span>);</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span> </div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>  <span class="comment">// Pawns at back ranks are used to encode en-passant, that&#39;s why we need to</span></div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>  <span class="comment">// check that a piece doesn&#39;t go from there.</span></div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">pawns_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(from) &amp;&amp; (from_rank != <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a> &amp;&amp; from_rank != <a class="code hl_variable" href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">kRank8</a>) &amp;&amp;</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>      (to_rank == <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a> || to_rank == <a class="code hl_variable" href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">kRank8</a>)) {</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>    <span class="comment">// Promotion.</span></div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>    <a class="code hl_struct" href="structlczero_1_1PieceType.html">PieceType</a> promotion =</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>        move_str.size() &gt; 4 ? <a class="code hl_function" href="structlczero_1_1PieceType.html#aaa8792338df7836291b9f4af82d8596f">PieceType::Parse</a>(move_str[4]) : <a class="code hl_variable" href="namespacelczero.html#a2743992b7a93253ed85da4ca7a9280b6">kKnight</a>;</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>    <span class="keywordflow">if</span> (!promotion.<a class="code hl_function" href="structlczero_1_1PieceType.html#ad3fabcb3a76c9f1b1b993ad45f67a57e">CanPromoteInto</a>()) complain(<span class="stringliteral">&quot;invalid promotion&quot;</span>);</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classlczero_1_1Move.html#ab971f0e995e2de029b82a086c3c9aa97">Move::WhitePromotion</a>(from, to, promotion);</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>  }</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>  <span class="keywordflow">if</span> (from == <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a> &amp;&amp; <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">our_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(to)) {</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>    <span class="comment">// FRC-style castling.</span></div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classlczero_1_1Move.html#ae7391dab4225a5a361479a1b291dce01">Move::WhiteCastling</a>(from.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>(), to.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>());</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>  }</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>  <span class="keywordflow">if</span> (from == <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a> &amp;&amp; from == <a class="code hl_variable" href="namespacelczero.html#ac5cec0ebb4f6f162f521ef3bd4019d94">kSquareE1</a> &amp;&amp; to == <a class="code hl_variable" href="namespacelczero.html#ab27568b5f5a332768b79774befca46a8">kSquareG1</a>) {</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>    <span class="comment">// Kingside castling.</span></div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classlczero_1_1Move.html#ae7391dab4225a5a361479a1b291dce01">Move::WhiteCastling</a>(from.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>(), <a class="code hl_variable" href="namespacelczero.html#a136a9e0535b2b6f5c567564e677e8fd3">kFileH</a>);</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>  }</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>  <span class="keywordflow">if</span> (from == <a class="code hl_variable" href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">our_king_</a> &amp;&amp; from == <a class="code hl_variable" href="namespacelczero.html#ac5cec0ebb4f6f162f521ef3bd4019d94">kSquareE1</a> &amp;&amp; to == <a class="code hl_variable" href="namespacelczero.html#ab44f57be1208208c587310705b8ae964">kSquareC1</a>) {</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>    <span class="comment">// Qeenside castling.</span></div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classlczero_1_1Move.html#ae7391dab4225a5a361479a1b291dce01">Move::WhiteCastling</a>(from.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>(), <a class="code hl_variable" href="namespacelczero.html#a1f4ade4e159941c4938d8ce7283c7a78">kFileA</a>);</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>  }</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>  <span class="keywordflow">if</span> (from.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>() != to.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>() &amp;&amp; <a class="code hl_function" href="classlczero_1_1ChessBoard.html#a4ff6ab258621e94fb4dff398d3a9c27d">pawns</a>().get(from) &amp;&amp; !<a class="code hl_variable" href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">their_pieces_</a>.<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(to)) {</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>    <span class="comment">// En passant.</span></div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classlczero_1_1Move.html#a5eee1ccc3a2abb902b418d3f10e4c3d2">Move::WhiteEnPassant</a>(from, to);</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>  }</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="classlczero_1_1Move.html#a4f4265b3d63caa54bf2e041b19568114">Move::White</a>(from, to);</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>}</div>
</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span> </div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span><span class="keywordtype">char</span> GetPieceAt(<span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1ChessBoard.html">lczero::ChessBoard</a>&amp; board, <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> square) {</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>  <span class="keywordtype">char</span> c = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>  <span class="keywordflow">if</span> (board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#ac74c92c22299c3332550032e114c5ed4">ours</a>().<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(square) || board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a>().<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(square)) {</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>    <span class="keywordflow">if</span> (board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a4ff6ab258621e94fb4dff398d3a9c27d">pawns</a>().<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(square)) {</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>      c = <span class="charliteral">&#39;P&#39;</span>;</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a45bae22afa3ecc26233763bbdc577cec">kings</a>().<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(square)) {</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>      c = <span class="charliteral">&#39;K&#39;</span>;</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a639fe9f9322150c557a78aae4f7e2b40">bishops</a>().<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(square)) {</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>      c = <span class="charliteral">&#39;B&#39;</span>;</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#af1cf4f04db5f12c6e14c509127456443">queens</a>().<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(square)) {</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>      c = <span class="charliteral">&#39;Q&#39;</span>;</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#ab3dac08b8fd24e8a1a8276af8f2fd975">rooks</a>().<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(square)) {</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>      c = <span class="charliteral">&#39;R&#39;</span>;</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>      c = <span class="charliteral">&#39;N&#39;</span>;</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>    }</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>    <span class="keywordflow">if</span> (board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">theirs</a>().<a class="code hl_function" href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">get</a>(square)) {</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>      c = std::tolower(c);  <span class="comment">// Capitals are for white.</span></div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>    }</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>  }</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>  <span class="keywordflow">return</span> c;</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>}</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span> </div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>}  <span class="comment">// namespace</span></div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span> </div>
<div class="foldopen" id="foldopen01227" data-start="{" data-end="}">
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"><a class="line" href="namespacelczero.html#a8452fa1da52ea13a4ecbe4bdaae64801"> 1227</a></span>std::string <a class="code hl_function" href="namespacelczero.html#a8452fa1da52ea13a4ecbe4bdaae64801">BoardToFen</a>(<span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1ChessBoard.html">ChessBoard</a>&amp; in_board) {</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>  <a class="code hl_class" href="classlczero_1_1ChessBoard.html">ChessBoard</a> board(in_board);</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> black_to_move = board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a712259c26bc9c44dbff0ab563a851c01">flipped</a>();</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>  <span class="keywordflow">if</span> (black_to_move) board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a71f55c55d217e5948991d54017b083bb">Mirror</a>();</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>  std::string <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>;</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>  <span class="keywordflow">for</span> (<a class="code hl_struct" href="structlczero_1_1Rank.html">Rank</a> rank = <a class="code hl_variable" href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">kRank8</a>; rank.<a class="code hl_function" href="structlczero_1_1Rank.html#a413a5fe2c1738bdd468aaa41fc239a14">IsValid</a>(); --rank) {</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>    <span class="keywordtype">int</span> empty = 0;</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>    <span class="keywordflow">for</span> (<a class="code hl_struct" href="structlczero_1_1File.html">File</a> file = <a class="code hl_variable" href="namespacelczero.html#a1f4ade4e159941c4938d8ce7283c7a78">kFileA</a>; file &lt;= <a class="code hl_variable" href="namespacelczero.html#a136a9e0535b2b6f5c567564e677e8fd3">kFileH</a>; ++file) {</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>      <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> square(file, rank);</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>      <span class="keywordtype">char</span> piece = GetPieceAt(board, square);</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>      <span class="keywordflow">if</span> (piece) {</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>        <span class="keywordflow">if</span> (empty) <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a> += std::to_string(empty);</div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>        empty = 0;</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>        <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a> += piece;</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>        ++empty;</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>      }</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>    }</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>    <span class="keywordflow">if</span> (empty) <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a> += std::to_string(empty);</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>    <span class="keywordflow">if</span> (rank != <a class="code hl_variable" href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">kRank1</a>) <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a> += <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>  }</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>  <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a> += black_to_move ? <span class="stringliteral">&quot; b&quot;</span> : <span class="stringliteral">&quot; w&quot;</span>;</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>  <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a> += <span class="stringliteral">&quot; &quot;</span> + board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#afa96d6d2c92bf76e0a61d8fa8bd35768">castlings</a>().<a class="code hl_function" href="classlczero_1_1ChessBoard_1_1Castlings.html#a57317e4a3d49ad7e5a46641f2b35fbdd">as_string</a>();</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>  std::string ep = <span class="stringliteral">&quot;-&quot;</span>;</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>  <span class="keywordflow">if</span> (!board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a6a01c9182470d79b3ef663f74ae8a849">en_passant</a>().<a class="code hl_function" href="classlczero_1_1BitBoard.html#ac5ab5710b6f8d85b21014ac1fff54484">empty</a>()) {</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>    <span class="keyword">const</span> <a class="code hl_class" href="classlczero_1_1Square.html">Square</a> sq = *board.<a class="code hl_function" href="classlczero_1_1ChessBoard.html#a6a01c9182470d79b3ef663f74ae8a849">en_passant</a>().<a class="code hl_function" href="classlczero_1_1BitBoard.html#a65a0b690f9991aa09ca3bc7b346fdd2f">begin</a>();</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>    ep = <a class="code hl_class" href="classlczero_1_1Square.html">Square</a>(sq.<a class="code hl_function" href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">file</a>(), black_to_move ? <a class="code hl_variable" href="namespacelczero.html#a5ea88ee0fd79db239cdaf230f834375a">kRank3</a> : <a class="code hl_variable" href="namespacelczero.html#a6b88338029954ece6a181e1adbf63dd3">kRank6</a>).ToString(<span class="keyword">false</span>);</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>  }</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>  <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a> += <span class="stringliteral">&quot; &quot;</span> + ep;</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a>;</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>}</div>
</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span> </div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>}  <span class="comment">// namespace lczero</span></div>
<div class="ttc" id="aboard_8cc_html_a7e57738e999c4baae71a2d86d07c2561"><div class="ttname"><a href="board_8cc.html#a7e57738e999c4baae71a2d86d07c2561">attacks_table_</a></div><div class="ttdeci">BitBoard * attacks_table_</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00188">board.cc:188</a></div></div>
<div class="ttc" id="aboard_8cc_html_aee3a0c29b42b0abb554798477e8d4029"><div class="ttname"><a href="board_8cc.html#aee3a0c29b42b0abb554798477e8d4029">mask_</a></div><div class="ttdeci">uint64_t mask_</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00186">board.cc:186</a></div></div>
<div class="ttc" id="aboard_8h_html"><div class="ttname"><a href="board_8h.html">board.h</a></div></div>
<div class="ttc" id="aboard__test_8cc_html_a241b458f7cc40b7fdafd623795f4f7f0"><div class="ttname"><a href="board__test_8cc.html#a241b458f7cc40b7fdafd623795f4f7f0">fen</a></div><div class="ttdeci">const char *const fen</div><div class="ttdef"><b>Definition</b> <a href="board__test_8cc_source.html#l00188">board_test.cc:188</a></div></div>
<div class="ttc" id="aclasslczero_1_1BitBoard_html"><div class="ttname"><a href="classlczero_1_1BitBoard.html">lczero::BitBoard</a></div><div class="ttdef"><b>Definition</b> <a href="bitboard_8h_source.html#l00043">bitboard.h:43</a></div></div>
<div class="ttc" id="aclasslczero_1_1BitBoard_html_a19855cfecc8374909ac9ceed137553c1"><div class="ttname"><a href="classlczero_1_1BitBoard.html#a19855cfecc8374909ac9ceed137553c1">lczero::BitBoard::get</a></div><div class="ttdeci">bool get(Square square) const</div><div class="ttdef"><b>Definition</b> <a href="bitboard_8h_source.html#l00098">bitboard.h:98</a></div></div>
<div class="ttc" id="aclasslczero_1_1BitBoard_html_a4b52974ec566cf80c2223745803d170f"><div class="ttname"><a href="classlczero_1_1BitBoard.html#a4b52974ec566cf80c2223745803d170f">lczero::BitBoard::set</a></div><div class="ttdeci">void set(Square square)</div><div class="ttdef"><b>Definition</b> <a href="bitboard_8h_source.html#l00094">bitboard.h:94</a></div></div>
<div class="ttc" id="aclasslczero_1_1BitBoard_html_a65a0b690f9991aa09ca3bc7b346fdd2f"><div class="ttname"><a href="classlczero_1_1BitBoard.html#a65a0b690f9991aa09ca3bc7b346fdd2f">lczero::BitBoard::begin</a></div><div class="ttdeci">Iterator begin() const</div><div class="ttdef"><b>Definition</b> <a href="bitboard_8h_source.html#l00116">bitboard.h:116</a></div></div>
<div class="ttc" id="aclasslczero_1_1BitBoard_html_a971d09a5d2d09cf2e1f34af13b059fda"><div class="ttname"><a href="classlczero_1_1BitBoard.html#a971d09a5d2d09cf2e1f34af13b059fda">lczero::BitBoard::set_if</a></div><div class="ttdeci">void set_if(Square square, bool cond)</div><div class="ttdef"><b>Definition</b> <a href="bitboard_8h_source.html#l00090">bitboard.h:90</a></div></div>
<div class="ttc" id="aclasslczero_1_1BitBoard_html_abc50ada4a1210302f8fc069b2ebd74f3"><div class="ttname"><a href="classlczero_1_1BitBoard.html#abc50ada4a1210302f8fc069b2ebd74f3">lczero::BitBoard::reset</a></div><div class="ttdeci">void reset(Square square)</div><div class="ttdef"><b>Definition</b> <a href="bitboard_8h_source.html#l00096">bitboard.h:96</a></div></div>
<div class="ttc" id="aclasslczero_1_1BitBoard_html_abfa0d6cca4385dc2f6e7524f68b56694"><div class="ttname"><a href="classlczero_1_1BitBoard.html#abfa0d6cca4385dc2f6e7524f68b56694">lczero::BitBoard::as_int</a></div><div class="ttdeci">std::uint64_t as_int() const</div><div class="ttdef"><b>Definition</b> <a href="bitboard_8h_source.html#l00051">bitboard.h:51</a></div></div>
<div class="ttc" id="aclasslczero_1_1BitBoard_html_ac5ab5710b6f8d85b21014ac1fff54484"><div class="ttname"><a href="classlczero_1_1BitBoard.html#ac5ab5710b6f8d85b21014ac1fff54484">lczero::BitBoard::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition</b> <a href="bitboard_8h_source.html#l00101">bitboard.h:101</a></div></div>
<div class="ttc" id="aclasslczero_1_1BitBoard_html_acbf14a35154c37d0138324d666387df9"><div class="ttname"><a href="classlczero_1_1BitBoard.html#acbf14a35154c37d0138324d666387df9">lczero::BitBoard::intersects</a></div><div class="ttdeci">bool intersects(const BitBoard &amp;other) const</div><div class="ttdef"><b>Definition</b> <a href="bitboard_8h_source.html#l00104">bitboard.h:104</a></div></div>
<div class="ttc" id="aclasslczero_1_1BitBoard_html_adabc129aadaf4ae7bfd6aa884282d9d8"><div class="ttname"><a href="classlczero_1_1BitBoard.html#adabc129aadaf4ae7bfd6aa884282d9d8">lczero::BitBoard::Mirror</a></div><div class="ttdeci">void Mirror()</div><div class="ttdef"><b>Definition</b> <a href="bitboard_8h_source.html#l00107">bitboard.h:107</a></div></div>
<div class="ttc" id="aclasslczero_1_1BitBoard_html_afdcbdf9e0887c6950ab163297429440b"><div class="ttname"><a href="classlczero_1_1BitBoard.html#afdcbdf9e0887c6950ab163297429440b">lczero::BitBoard::FromSquare</a></div><div class="ttdeci">static constexpr BitBoard FromSquare(Square square)</div><div class="ttdef"><b>Definition</b> <a href="bitboard_8h_source.html#l00047">bitboard.h:47</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_a063e7eaeb8e09e792560a0bfdfe74e05"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#a063e7eaeb8e09e792560a0bfdfe74e05">lczero::ChessBoard::Castlings::reset_we_can_00</a></div><div class="ttdeci">void reset_we_can_00()</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00180">board.h:180</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_a09a5166ab6c7c3ecdb6427ac31e4911b"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#a09a5166ab6c7c3ecdb6427ac31e4911b">lczero::ChessBoard::Castlings::we_can_00</a></div><div class="ttdeci">bool we_can_00() const</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00185">board.h:185</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_a32dbd73e8129164c13705e6742f34722"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#a32dbd73e8129164c13705e6742f34722">lczero::ChessBoard::Castlings::set_we_can_00</a></div><div class="ttdeci">void set_we_can_00()</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00175">board.h:175</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_a36d5ef6b4187636c58790166511ed7cc"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#a36d5ef6b4187636c58790166511ed7cc">lczero::ChessBoard::Castlings::our_kingside_rook</a></div><div class="ttdeci">File our_kingside_rook</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00241">board.h:241</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_a41f95c60973a3c73695e92cd04437285"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#a41f95c60973a3c73695e92cd04437285">lczero::ChessBoard::Castlings::set_they_can_000</a></div><div class="ttdeci">void set_they_can_000()</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00178">board.h:178</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_a57317e4a3d49ad7e5a46641f2b35fbdd"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#a57317e4a3d49ad7e5a46641f2b35fbdd">lczero::ChessBoard::Castlings::as_string</a></div><div class="ttdeci">std::string as_string() const</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00200">board.h:200</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_a5a7fc935a660287d3b76c1137fbce98e"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#a5a7fc935a660287d3b76c1137fbce98e">lczero::ChessBoard::Castlings::Mirror</a></div><div class="ttdeci">void Mirror()</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00191">board.h:191</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_a5e65efdefea109c2b313a2068e8d28b1"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#a5e65efdefea109c2b313a2068e8d28b1">lczero::ChessBoard::Castlings::our_queenside_rook</a></div><div class="ttdeci">File our_queenside_rook</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00238">board.h:238</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_a747bebf8728dd8e2f39a28f842dc6ac4"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#a747bebf8728dd8e2f39a28f842dc6ac4">lczero::ChessBoard::Castlings::set_they_can_00</a></div><div class="ttdeci">void set_they_can_00()</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00177">board.h:177</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_a83e6b5a221d87d78bd04fb8f7713e2a8"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#a83e6b5a221d87d78bd04fb8f7713e2a8">lczero::ChessBoard::Castlings::their_kingside_rook</a></div><div class="ttdeci">File their_kingside_rook</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00242">board.h:242</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_a85d49d6f76b28ff23c8b41624a841a78"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#a85d49d6f76b28ff23c8b41624a841a78">lczero::ChessBoard::Castlings::reset_we_can_000</a></div><div class="ttdeci">void reset_we_can_000()</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00181">board.h:181</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_ac7afa6bf3f54171cb2404b6870e6d079"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#ac7afa6bf3f54171cb2404b6870e6d079">lczero::ChessBoard::Castlings::their_queenside_rook</a></div><div class="ttdeci">File their_queenside_rook</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00239">board.h:239</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_adb0b639d544320169f162a3a62c426bb"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#adb0b639d544320169f162a3a62c426bb">lczero::ChessBoard::Castlings::set_we_can_000</a></div><div class="ttdeci">void set_we_can_000()</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00176">board.h:176</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_adcde95a0c7f868073369cfd4c062f7fc"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#adcde95a0c7f868073369cfd4c062f7fc">lczero::ChessBoard::Castlings::reset_they_can_00</a></div><div class="ttdeci">void reset_they_can_00()</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00182">board.h:182</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_aece3daeb188fdab98565252cc7681721"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#aece3daeb188fdab98565252cc7681721">lczero::ChessBoard::Castlings::reset_they_can_000</a></div><div class="ttdeci">void reset_they_can_000()</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00183">board.h:183</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_1_1Castlings_html_af05cd4e30bfcb9d02eeaff8a2509e262"><div class="ttname"><a href="classlczero_1_1ChessBoard_1_1Castlings.html#af05cd4e30bfcb9d02eeaff8a2509e262">lczero::ChessBoard::Castlings::we_can_000</a></div><div class="ttdeci">bool we_can_000() const</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00186">board.h:186</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html"><div class="ttname"><a href="classlczero_1_1ChessBoard.html">lczero::ChessBoard</a></div><div class="ttdoc">Represents a chess board position in the Lc0 engine.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00064">board.h:64</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a0f21b051a004b0fba25071a9b07999bc"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a0f21b051a004b0fba25071a9b07999bc">lczero::ChessBoard::knights</a></div><div class="ttdeci">BitBoard knights() const</div><div class="ttdoc">Gets the bitboard of knights on the board.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00291">board.h:291</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a136b3c71ba506572774491470e28bc55"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a136b3c71ba506572774491470e28bc55">lczero::ChessBoard::kStartposFen</a></div><div class="ttdeci">static const char * kStartposFen</div><div class="ttdoc">Standard chess starting position in FEN notation.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00083">board.h:83</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a1c677b922401c38a0b89df2cc61eb54a"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a1c677b922401c38a0b89df2cc61eb54a">lczero::ChessBoard::PutPiece</a></div><div class="ttdeci">void PutPiece(Square square, PieceType piece, bool is_theirs)</div><div class="ttdoc">Places a piece on a specific square of the board.</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00969">board.cc:969</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a2421e797e3a4c248a43685a70dad19fa"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a2421e797e3a4c248a43685a70dad19fa">lczero::ChessBoard::theirs</a></div><div class="ttdeci">BitBoard theirs() const</div><div class="ttdoc">Gets the bitboard of pieces belonging to the opponent (&quot;them&quot;).</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00262">board.h:262</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a25a6ec4afd36ca8de6bc4f1b0e1cd302"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a25a6ec4afd36ca8de6bc4f1b0e1cd302">lczero::ChessBoard::ParseMove</a></div><div class="ttdeci">Move ParseMove(std::string_view move_str) const</div><div class="ttdoc">Parses a move from algebraic notation string.</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l01150">board.cc:1150</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a27c5a83e4c61997ba61dd7d9af7cf649"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a27c5a83e4c61997ba61dd7d9af7cf649">lczero::ChessBoard::castlings_</a></div><div class="ttdeci">Castlings castlings_</div><div class="ttdoc">Object containing castling rights information for both players.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00356">board.h:356</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a3ac6e98b875aa545aad2509b5711a46c"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a3ac6e98b875aa545aad2509b5711a46c">lczero::ChessBoard::IsUnderCheck</a></div><div class="ttdeci">bool IsUnderCheck() const</div><div class="ttdoc">Checks if the current player's king (&quot;our&quot; king, treated as white internally) is under check.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00131">board.h:131</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a459676c5f973018a5d73bd59964a55f0"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a459676c5f973018a5d73bd59964a55f0">lczero::ChessBoard::kStartposBoard</a></div><div class="ttdeci">static const ChessBoard kStartposBoard</div><div class="ttdoc">Pre-initialized starting position board.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00086">board.h:86</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a45bae22afa3ecc26233763bbdc577cec"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a45bae22afa3ecc26233763bbdc577cec">lczero::ChessBoard::kings</a></div><div class="ttdeci">BitBoard kings() const</div><div class="ttdoc">Gets the bitboard of kings on the board.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00298">board.h:298</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a4c33d4852a273e8844afe286affdb386"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a4c33d4852a273e8844afe286affdb386">lczero::ChessBoard::ChessBoard</a></div><div class="ttdeci">ChessBoard()=default</div><div class="ttdoc">Default constructor for a chess board.</div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a4ff6ab258621e94fb4dff398d3a9c27d"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a4ff6ab258621e94fb4dff398d3a9c27d">lczero::ChessBoard::pawns</a></div><div class="ttdeci">BitBoard pawns() const</div><div class="ttdoc">Gets the bitboard of pawns on the board.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00267">board.h:267</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a639fe9f9322150c557a78aae4f7e2b40"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a639fe9f9322150c557a78aae4f7e2b40">lczero::ChessBoard::bishops</a></div><div class="ttdeci">BitBoard bishops() const</div><div class="ttdoc">Gets the bitboard of bishops on the board.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00277">board.h:277</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a6a01c9182470d79b3ef663f74ae8a849"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a6a01c9182470d79b3ef663f74ae8a849">lczero::ChessBoard::en_passant</a></div><div class="ttdeci">BitBoard en_passant() const</div><div class="ttdoc">Gets the bitboard of en passant targets.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00272">board.h:272</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a6d5d9ba8280cdf1ed963500f0b317145"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a6d5d9ba8280cdf1ed963500f0b317145">lczero::ChessBoard::DebugString</a></div><div class="ttdeci">std::string DebugString() const</div><div class="ttdoc">Gets a debug string representation of the board state.</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l01144">board.cc:1144</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a712259c26bc9c44dbff0ab563a851c01"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a712259c26bc9c44dbff0ab563a851c01">lczero::ChessBoard::flipped</a></div><div class="ttdeci">bool flipped() const</div><div class="ttdoc">Checks if the board is flipped (currently black's turn to move).</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00308">board.h:308</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a716eb4e4439e609928eb57ec4f4c7670"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a716eb4e4439e609928eb57ec4f4c7670">lczero::ChessBoard::GenerateLegalMoves</a></div><div class="ttdeci">MoveList GenerateLegalMoves() const</div><div class="ttdoc">Generates a list of legal moves for the current player.</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00959">board.cc:959</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a71f55c55d217e5948991d54017b083bb"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a71f55c55d217e5948991d54017b083bb">lczero::ChessBoard::Mirror</a></div><div class="ttdeci">void Mirror()</div><div class="ttdoc">Swaps black and white pieces and mirrors them relative to the middle of the board.</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00057">board.cc:57</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a7d970bc551931e66ee9c5923c827b1cf"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a7d970bc551931e66ee9c5923c827b1cf">lczero::ChessBoard::HasMatingMaterial</a></div><div class="ttdeci">bool HasMatingMaterial() const</div><div class="ttdoc">Checks whether at least one side has sufficient material for checkmate.</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l01121">board.cc:1121</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a858ebb9f5d28b4e29f4912e85af74b6b"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a858ebb9f5d28b4e29f4912e85af74b6b">lczero::ChessBoard::rooks_</a></div><div class="ttdeci">BitBoard rooks_</div><div class="ttdoc">Bitboard containing all rooks and queens (both players).</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00338">board.h:338</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a8e234d2282583ffdf00d96ffba951aa7"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a8e234d2282583ffdf00d96ffba951aa7">lczero::ChessBoard::IsUnderAttack</a></div><div class="ttdeci">bool IsUnderAttack(Square square) const</div><div class="ttdoc">Checks if a square is under attack from the opponent (&quot;them&quot;, treated as black internally).</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00728">board.cc:728</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a92cef3b5ecadb2db2f1f6cb693860a84"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a92cef3b5ecadb2db2f1f6cb693860a84">lczero::ChessBoard::Clear</a></div><div class="ttdeci">void Clear()</div><div class="ttdoc">Clears the entire board state to empty.</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00055">board.cc:55</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_a9b9bffb8d337e244d7bf89f5ef9d511f"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#a9b9bffb8d337e244d7bf89f5ef9d511f">lczero::ChessBoard::their_pieces_</a></div><div class="ttdeci">BitBoard their_pieces_</div><div class="ttdoc">Bitboard containing all pieces of the opponent (treated as black internally).</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00335">board.h:335</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_aa6d933726bfce835ecf7ce2b0094a63f"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#aa6d933726bfce835ecf7ce2b0094a63f">lczero::ChessBoard::SetFromFen</a></div><div class="ttdeci">void SetFromFen(std::string_view fen, int *rule50_ply=nullptr, int *moves=nullptr)</div><div class="ttdoc">Sets the board position from a FEN string.</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00977">board.cc:977</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_aab41623db3d969727780dc379e4a5bea"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#aab41623db3d969727780dc379e4a5bea">lczero::ChessBoard::our_pieces_</a></div><div class="ttdeci">BitBoard our_pieces_</div><div class="ttdoc">Bitboard containing all pieces of the current player (treated as white internally).</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00332">board.h:332</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_ab0145635eedf532be94fed81e80ed7a6"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#ab0145635eedf532be94fed81e80ed7a6">lczero::ChessBoard::pawns_</a></div><div class="ttdeci">BitBoard pawns_</div><div class="ttdoc">Bitboard containing all pawns and en passant markers.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00347">board.h:347</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_ab24b2476e34ef43596501ac717832fb3"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#ab24b2476e34ef43596501ac717832fb3">lczero::ChessBoard::ApplyMove</a></div><div class="ttdeci">bool ApplyMove(Move move)</div><div class="ttdoc">Applies a move to the board.</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00596">board.cc:596</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_ab3dac08b8fd24e8a1a8276af8f2fd975"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#ab3dac08b8fd24e8a1a8276af8f2fd975">lczero::ChessBoard::rooks</a></div><div class="ttdeci">BitBoard rooks() const</div><div class="ttdoc">Gets the bitboard of rooks on the board.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00282">board.h:282</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_ac3cb53799c242f72362f540ad77a4df9"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#ac3cb53799c242f72362f540ad77a4df9">lczero::ChessBoard::their_king_</a></div><div class="ttdeci">Square their_king_</div><div class="ttdoc">Square position of the opponent's king (treated as black internally).</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00353">board.h:353</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_ac516f6bf313c488818f93c812e76a3f4"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#ac516f6bf313c488818f93c812e76a3f4">lczero::ChessBoard::our_king_</a></div><div class="ttdeci">Square our_king_</div><div class="ttdoc">Square position of the current player's king (treated as white internally).</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00350">board.h:350</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_ac74c92c22299c3332550032e114c5ed4"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#ac74c92c22299c3332550032e114c5ed4">lczero::ChessBoard::ours</a></div><div class="ttdeci">BitBoard ours() const</div><div class="ttdoc">Gets the bitboard of pieces belonging to the current player (&quot;us&quot;).</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00258">board.h:258</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_acad96c5f01eb6a37cc1c1c39a29f0d8f"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#acad96c5f01eb6a37cc1c1c39a29f0d8f">lczero::ChessBoard::bishops_</a></div><div class="ttdeci">BitBoard bishops_</div><div class="ttdoc">Bitboard containing all bishops and queens (both players).</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00341">board.h:341</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_ad05bfccb4b65300ae770ea970e1be288"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#ad05bfccb4b65300ae770ea970e1be288">lczero::ChessBoard::GeneratePseudolegalMoves</a></div><div class="ttdeci">MoveList GeneratePseudolegalMoves() const</div><div class="ttdoc">Generates a list of possible moves for the current player (&quot;us&quot;, treated as white internally).</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00430">board.cc:430</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_ad09e84ee411b61f7245c148718c33786"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#ad09e84ee411b61f7245c148718c33786">lczero::ChessBoard::IsLegalMove</a></div><div class="ttdeci">bool IsLegalMove(Move move, const KingAttackInfo &amp;king_attack_info) const</div><div class="ttdoc">Checks whether a pseudolegal move is actually legal (doesn't leave own king in check).</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00888">board.cc:888</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_ae7ae4e6378972211390dd6ff4d7698f3"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#ae7ae4e6378972211390dd6ff4d7698f3">lczero::ChessBoard::IsValid</a></div><div class="ttdeci">bool IsValid() const</div><div class="ttdoc">Checks if the internal board state is consistent after transformations.</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00577">board.cc:577</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_aecd6a3874def234ec0244942531a2793"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#aecd6a3874def234ec0244942531a2793">lczero::ChessBoard::kPawnMask</a></div><div class="ttdeci">static const BitBoard kPawnMask</div><div class="ttdoc">Bitboard mask for identifying pawns vs en passant markers.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00089">board.h:89</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_af1cf4f04db5f12c6e14c509127456443"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#af1cf4f04db5f12c6e14c509127456443">lczero::ChessBoard::queens</a></div><div class="ttdeci">BitBoard queens() const</div><div class="ttdoc">Gets the bitboard of queens on the board.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00286">board.h:286</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_afa96d6d2c92bf76e0a61d8fa8bd35768"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#afa96d6d2c92bf76e0a61d8fa8bd35768">lczero::ChessBoard::castlings</a></div><div class="ttdeci">const Castlings &amp; castlings() const</div><div class="ttdoc">Gets the castling rights information for the position.</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00304">board.h:304</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_afbbcac155ea7795b5288da2512516e14"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#afbbcac155ea7795b5288da2512516e14">lczero::ChessBoard::flipped_</a></div><div class="ttdeci">bool flipped_</div><div class="ttdoc">Flag indicating if the board is flipped (black to move).</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00360">board.h:360</a></div></div>
<div class="ttc" id="aclasslczero_1_1ChessBoard_html_afde6f038fa4b9d5c6f12c332ec5e557a"><div class="ttname"><a href="classlczero_1_1ChessBoard.html#afde6f038fa4b9d5c6f12c332ec5e557a">lczero::ChessBoard::GenerateKingAttackInfo</a></div><div class="ttdeci">KingAttackInfo GenerateKingAttackInfo() const</div><div class="ttdoc">Generates king attack information used for legal move detection.</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00762">board.cc:762</a></div></div>
<div class="ttc" id="aclasslczero_1_1Exception_html"><div class="ttname"><a href="classlczero_1_1Exception.html">lczero::Exception</a></div><div class="ttdef"><b>Definition</b> <a href="exception_8h_source.html#l00036">exception.h:36</a></div></div>
<div class="ttc" id="aclasslczero_1_1KingAttackInfo_html"><div class="ttname"><a href="classlczero_1_1KingAttackInfo.html">lczero::KingAttackInfo</a></div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00043">board.h:43</a></div></div>
<div class="ttc" id="aclasslczero_1_1KingAttackInfo_html_a19b9415cd785cb2cd556a2405f92ed1b"><div class="ttname"><a href="classlczero_1_1KingAttackInfo.html#a19b9415cd785cb2cd556a2405f92ed1b">lczero::KingAttackInfo::double_check_</a></div><div class="ttdeci">bool double_check_</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00054">board.h:54</a></div></div>
<div class="ttc" id="aclasslczero_1_1KingAttackInfo_html_a3a58a8b7075a7cb67264454d64823029"><div class="ttname"><a href="classlczero_1_1KingAttackInfo.html#a3a58a8b7075a7cb67264454d64823029">lczero::KingAttackInfo::attack_lines_</a></div><div class="ttdeci">BitBoard attack_lines_</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00056">board.h:56</a></div></div>
<div class="ttc" id="aclasslczero_1_1KingAttackInfo_html_a4b516e8b7fde5c512a051bd42ee6880c"><div class="ttname"><a href="classlczero_1_1KingAttackInfo.html#a4b516e8b7fde5c512a051bd42ee6880c">lczero::KingAttackInfo::pinned_pieces_</a></div><div class="ttdeci">BitBoard pinned_pieces_</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00055">board.h:55</a></div></div>
<div class="ttc" id="aclasslczero_1_1KingAttackInfo_html_a807e500b1300f28fd33cf03dce54e0d7"><div class="ttname"><a href="classlczero_1_1KingAttackInfo.html#a807e500b1300f28fd33cf03dce54e0d7">lczero::KingAttackInfo::in_double_check</a></div><div class="ttdeci">bool in_double_check() const</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00046">board.h:46</a></div></div>
<div class="ttc" id="aclasslczero_1_1KingAttackInfo_html_a964313e5db7777c89b3115ca40d0fbc3"><div class="ttname"><a href="classlczero_1_1KingAttackInfo.html#a964313e5db7777c89b3115ca40d0fbc3">lczero::KingAttackInfo::is_pinned</a></div><div class="ttdeci">bool is_pinned(const Square square) const</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00047">board.h:47</a></div></div>
<div class="ttc" id="aclasslczero_1_1KingAttackInfo_html_ac030be6020e8fb290ab792f057fccf40"><div class="ttname"><a href="classlczero_1_1KingAttackInfo.html#ac030be6020e8fb290ab792f057fccf40">lczero::KingAttackInfo::is_on_attack_line</a></div><div class="ttdeci">bool is_on_attack_line(const Square square) const</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00050">board.h:50</a></div></div>
<div class="ttc" id="aclasslczero_1_1KingAttackInfo_html_ae46a55a16ba312f0084bd3b4769723a4"><div class="ttname"><a href="classlczero_1_1KingAttackInfo.html#ae46a55a16ba312f0084bd3b4769723a4">lczero::KingAttackInfo::in_check</a></div><div class="ttdeci">bool in_check() const</div><div class="ttdef"><b>Definition</b> <a href="board_8h_source.html#l00045">board.h:45</a></div></div>
<div class="ttc" id="aclasslczero_1_1Move_html"><div class="ttname"><a href="classlczero_1_1Move.html">lczero::Move</a></div><div class="ttdoc">Represents a chess move in the Lc0 engine.</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00143">types.h:143</a></div></div>
<div class="ttc" id="aclasslczero_1_1Move_html_a064296c9a78c5137b8b78287cb2f1dcd"><div class="ttname"><a href="classlczero_1_1Move.html#a064296c9a78c5137b8b78287cb2f1dcd">lczero::Move::ToString</a></div><div class="ttdeci">std::string ToString(bool is_chess960) const</div><div class="ttdoc">Converts the move to a string representation.</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00295">types.h:295</a></div></div>
<div class="ttc" id="aclasslczero_1_1Move_html_a32942da77fed0a1c88b139634355bcde"><div class="ttname"><a href="classlczero_1_1Move.html#a32942da77fed0a1c88b139634355bcde">lczero::Move::to</a></div><div class="ttdeci">Square to() const</div><div class="ttdoc">Gets the destination square of the move.</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00208">types.h:208</a></div></div>
<div class="ttc" id="aclasslczero_1_1Move_html_a44027392ace0f2aab156ded6db79bb88"><div class="ttname"><a href="classlczero_1_1Move.html#a44027392ace0f2aab156ded6db79bb88">lczero::Move::is_promotion</a></div><div class="ttdeci">bool is_promotion() const</div><div class="ttdoc">Checks if the move is a promotion.</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00212">types.h:212</a></div></div>
<div class="ttc" id="aclasslczero_1_1Move_html_a46024d874c08594f7fdb96d4e7cae4a4"><div class="ttname"><a href="classlczero_1_1Move.html#a46024d874c08594f7fdb96d4e7cae4a4">lczero::Move::is_en_passant</a></div><div class="ttdeci">bool is_en_passant() const</div><div class="ttdoc">Checks if the move is an en passant capture.</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00226">types.h:226</a></div></div>
<div class="ttc" id="aclasslczero_1_1Move_html_a4f4265b3d63caa54bf2e041b19568114"><div class="ttname"><a href="classlczero_1_1Move.html#a4f4265b3d63caa54bf2e041b19568114">lczero::Move::White</a></div><div class="ttdeci">static constexpr Move White(Square from, Square to)</div><div class="ttdoc">Creates a move for white pieces.</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00152">types.h:152</a></div></div>
<div class="ttc" id="aclasslczero_1_1Move_html_a5eee1ccc3a2abb902b418d3f10e4c3d2"><div class="ttname"><a href="classlczero_1_1Move.html#a5eee1ccc3a2abb902b418d3f10e4c3d2">lczero::Move::WhiteEnPassant</a></div><div class="ttdeci">static constexpr Move WhiteEnPassant(Square from, Square to)</div><div class="ttdoc">Creates an en passant move for white pieces.</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00179">types.h:179</a></div></div>
<div class="ttc" id="aclasslczero_1_1Move_html_aa1f8647a227fb3fd8086d69aeae65d87"><div class="ttname"><a href="classlczero_1_1Move.html#aa1f8647a227fb3fd8086d69aeae65d87">lczero::Move::promotion</a></div><div class="ttdeci">PieceType promotion() const</div><div class="ttdoc">Gets the promotion piece type if this is a promotion move.</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00216">types.h:216</a></div></div>
<div class="ttc" id="aclasslczero_1_1Move_html_ab971f0e995e2de029b82a086c3c9aa97"><div class="ttname"><a href="classlczero_1_1Move.html#ab971f0e995e2de029b82a086c3c9aa97">lczero::Move::WhitePromotion</a></div><div class="ttdeci">static constexpr Move WhitePromotion(Square from, Square to, PieceType promotion_piece)</div><div class="ttdoc">Creates a promotion move for white pieces.</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00161">types.h:161</a></div></div>
<div class="ttc" id="aclasslczero_1_1Move_html_acfd7dffa1ee25335cdf6d491c0234d07"><div class="ttname"><a href="classlczero_1_1Move.html#acfd7dffa1ee25335cdf6d491c0234d07">lczero::Move::from</a></div><div class="ttdeci">Square from() const</div><div class="ttdoc">Gets the source square of the move.</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00204">types.h:204</a></div></div>
<div class="ttc" id="aclasslczero_1_1Move_html_ae7391dab4225a5a361479a1b291dce01"><div class="ttname"><a href="classlczero_1_1Move.html#ae7391dab4225a5a361479a1b291dce01">lczero::Move::WhiteCastling</a></div><div class="ttdeci">static constexpr Move WhiteCastling(File king, File rook)</div><div class="ttdoc">Creates a castling move for white pieces.</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00171">types.h:171</a></div></div>
<div class="ttc" id="aclasslczero_1_1Move_html_afded3aeade40113e162a38065acce4ec"><div class="ttname"><a href="classlczero_1_1Move.html#afded3aeade40113e162a38065acce4ec">lczero::Move::is_castling</a></div><div class="ttdeci">bool is_castling() const</div><div class="ttdoc">Checks if the move is a castling move.</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00222">types.h:222</a></div></div>
<div class="ttc" id="aclasslczero_1_1Square_html"><div class="ttname"><a href="classlczero_1_1Square.html">lczero::Square</a></div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00109">types.h:109</a></div></div>
<div class="ttc" id="aclasslczero_1_1Square_html_a1be93b90eff22449c4a4a003b3ac2b99"><div class="ttname"><a href="classlczero_1_1Square.html#a1be93b90eff22449c4a4a003b3ac2b99">lczero::Square::as_idx</a></div><div class="ttdeci">constexpr uint8_t as_idx() const</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00124">types.h:124</a></div></div>
<div class="ttc" id="aclasslczero_1_1Square_html_a4a0426f2a21efdb8e2523ed453496711"><div class="ttname"><a href="classlczero_1_1Square.html#a4a0426f2a21efdb8e2523ed453496711">lczero::Square::rank</a></div><div class="ttdeci">constexpr Rank rank() const</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00116">types.h:116</a></div></div>
<div class="ttc" id="aclasslczero_1_1Square_html_a4b08b1d00cc91a02873fd818c0f7beb4"><div class="ttname"><a href="classlczero_1_1Square.html#a4b08b1d00cc91a02873fd818c0f7beb4">lczero::Square::Flip</a></div><div class="ttdeci">void Flip()</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00118">types.h:118</a></div></div>
<div class="ttc" id="aclasslczero_1_1Square_html_a780f26bb4732b4221a1178a46310e465"><div class="ttname"><a href="classlczero_1_1Square.html#a780f26bb4732b4221a1178a46310e465">lczero::Square::file</a></div><div class="ttdeci">constexpr File file() const</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00115">types.h:115</a></div></div>
<div class="ttc" id="aclasslczero_1_1Square_html_aec40d8b97f29773cc6672e67743e668d"><div class="ttname"><a href="classlczero_1_1Square.html#aec40d8b97f29773cc6672e67743e668d">lczero::Square::FromIdx</a></div><div class="ttdeci">static constexpr Square FromIdx(uint8_t idx)</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00113">types.h:113</a></div></div>
<div class="ttc" id="aexception_8h_html"><div class="ttname"><a href="exception_8h.html">exception.h</a></div></div>
<div class="ttc" id="alogging_8h_html_a176c0577baa96c686397bca42f7ee6ff"><div class="ttname"><a href="logging_8h.html#a176c0577baa96c686397bca42f7ee6ff">CERR</a></div><div class="ttdeci">#define CERR</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00092">logging.h:92</a></div></div>
<div class="ttc" id="amemcache_8cc_html_ac51334f57ef8b81c0629c9421798c344"><div class="ttname"><a href="memcache_8cc.html#ac51334f57ef8b81c0629c9421798c344">m</a></div><div class="ttdeci">float m</div><div class="ttdef"><b>Definition</b> <a href="memcache_8cc_source.html#l00048">memcache.cc:48</a></div></div>
<div class="ttc" id="anamespacelczero_html"><div class="ttname"><a href="namespacelczero.html">lczero</a></div><div class="ttdef"><b>Definition</b> <a href="bitboard_8h_source.html#l00038">bitboard.h:38</a></div></div>
<div class="ttc" id="anamespacelczero_html_a0848e0829c166e2448a9a48306c37e20"><div class="ttname"><a href="namespacelczero.html#a0848e0829c166e2448a9a48306c37e20">lczero::kRank1</a></div><div class="ttdeci">constexpr Rank kRank1</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00103">types.h:103</a></div></div>
<div class="ttc" id="anamespacelczero_html_a1217b167970921dc66f9c7d134e07931"><div class="ttname"><a href="namespacelczero.html#a1217b167970921dc66f9c7d134e07931">lczero::kQueen</a></div><div class="ttdeci">constexpr PieceType kQueen</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00053">types.h:53</a></div></div>
<div class="ttc" id="anamespacelczero_html_a136a9e0535b2b6f5c567564e677e8fd3"><div class="ttname"><a href="namespacelczero.html#a136a9e0535b2b6f5c567564e677e8fd3">lczero::kFileH</a></div><div class="ttdeci">constexpr File kFileH</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00083">types.h:83</a></div></div>
<div class="ttc" id="anamespacelczero_html_a1f4ade4e159941c4938d8ce7283c7a78"><div class="ttname"><a href="namespacelczero.html#a1f4ade4e159941c4938d8ce7283c7a78">lczero::kFileA</a></div><div class="ttdeci">constexpr File kFileA</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00080">types.h:80</a></div></div>
<div class="ttc" id="anamespacelczero_html_a2743992b7a93253ed85da4ca7a9280b6"><div class="ttname"><a href="namespacelczero.html#a2743992b7a93253ed85da4ca7a9280b6">lczero::kKnight</a></div><div class="ttdeci">constexpr PieceType kKnight</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00052">types.h:52</a></div></div>
<div class="ttc" id="anamespacelczero_html_a35faeebcefe15cd6f886ab393b90aa6a"><div class="ttname"><a href="namespacelczero.html#a35faeebcefe15cd6f886ab393b90aa6a">lczero::kFileG</a></div><div class="ttdeci">constexpr File kFileG</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00083">types.h:83</a></div></div>
<div class="ttc" id="anamespacelczero_html_a37a270956e892e67994b41422eff48fd"><div class="ttname"><a href="namespacelczero.html#a37a270956e892e67994b41422eff48fd">lczero::kRank4</a></div><div class="ttdeci">constexpr Rank kRank4</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00104">types.h:104</a></div></div>
<div class="ttc" id="anamespacelczero_html_a5b8bc88442fbb44b95cef7cfc0714a2a"><div class="ttname"><a href="namespacelczero.html#a5b8bc88442fbb44b95cef7cfc0714a2a">lczero::kRank5</a></div><div class="ttdeci">constexpr Rank kRank5</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00105">types.h:105</a></div></div>
<div class="ttc" id="anamespacelczero_html_a5ea88ee0fd79db239cdaf230f834375a"><div class="ttname"><a href="namespacelczero.html#a5ea88ee0fd79db239cdaf230f834375a">lczero::kRank3</a></div><div class="ttdeci">constexpr Rank kRank3</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00104">types.h:104</a></div></div>
<div class="ttc" id="anamespacelczero_html_a6b88338029954ece6a181e1adbf63dd3"><div class="ttname"><a href="namespacelczero.html#a6b88338029954ece6a181e1adbf63dd3">lczero::kRank6</a></div><div class="ttdeci">constexpr Rank kRank6</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00105">types.h:105</a></div></div>
<div class="ttc" id="anamespacelczero_html_a6c4ba6363db124cd8e0926a5c125d617"><div class="ttname"><a href="namespacelczero.html#a6c4ba6363db124cd8e0926a5c125d617">lczero::kKing</a></div><div class="ttdeci">constexpr PieceType kKing</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00057">types.h:57</a></div></div>
<div class="ttc" id="anamespacelczero_html_a8452fa1da52ea13a4ecbe4bdaae64801"><div class="ttname"><a href="namespacelczero.html#a8452fa1da52ea13a4ecbe4bdaae64801">lczero::BoardToFen</a></div><div class="ttdeci">std::string BoardToFen(const ChessBoard &amp;in_board)</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l01227">board.cc:1227</a></div></div>
<div class="ttc" id="anamespacelczero_html_a96f1f63d9271a0f81b3c94acb93b3d99"><div class="ttname"><a href="namespacelczero.html#a96f1f63d9271a0f81b3c94acb93b3d99">lczero::kBishop</a></div><div class="ttdeci">constexpr PieceType kBishop</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00055">types.h:55</a></div></div>
<div class="ttc" id="anamespacelczero_html_a9d23dd7ce7b52c2a4437775fdecad2a1"><div class="ttname"><a href="namespacelczero.html#a9d23dd7ce7b52c2a4437775fdecad2a1">lczero::InitializeMagicBitboards</a></div><div class="ttdeci">void InitializeMagicBitboards()</div><div class="ttdef"><b>Definition</b> <a href="board_8cc_source.html#l00413">board.cc:413</a></div></div>
<div class="ttc" id="anamespacelczero_html_aa171f8367781ec0e439fb73801bae029"><div class="ttname"><a href="namespacelczero.html#aa171f8367781ec0e439fb73801bae029">lczero::MoveList</a></div><div class="ttdeci">std::vector&lt; Move &gt; MoveList</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00304">types.h:304</a></div></div>
<div class="ttc" id="anamespacelczero_html_aaa588977c472aff4f9d7587bf81765bc"><div class="ttname"><a href="namespacelczero.html#aaa588977c472aff4f9d7587bf81765bc">lczero::kFileD</a></div><div class="ttdeci">constexpr File kFileD</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00081">types.h:81</a></div></div>
<div class="ttc" id="anamespacelczero_html_ab0680a91458c153efbb90c83c35687a9"><div class="ttname"><a href="namespacelczero.html#ab0680a91458c153efbb90c83c35687a9">lczero::kRank8</a></div><div class="ttdeci">constexpr Rank kRank8</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00106">types.h:106</a></div></div>
<div class="ttc" id="anamespacelczero_html_ab27568b5f5a332768b79774befca46a8"><div class="ttname"><a href="namespacelczero.html#ab27568b5f5a332768b79774befca46a8">lczero::kSquareG1</a></div><div class="ttdeci">constexpr Square kSquareG1</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00136">types.h:136</a></div></div>
<div class="ttc" id="anamespacelczero_html_ab44f57be1208208c587310705b8ae964"><div class="ttname"><a href="namespacelczero.html#ab44f57be1208208c587310705b8ae964">lczero::kSquareC1</a></div><div class="ttdeci">constexpr Square kSquareC1</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00134">types.h:134</a></div></div>
<div class="ttc" id="anamespacelczero_html_ab7917414c2cb7a3872ea8bfe4033b415"><div class="ttname"><a href="namespacelczero.html#ab7917414c2cb7a3872ea8bfe4033b415">lczero::kFileC</a></div><div class="ttdeci">constexpr File kFileC</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00081">types.h:81</a></div></div>
<div class="ttc" id="anamespacelczero_html_ac5cec0ebb4f6f162f521ef3bd4019d94"><div class="ttname"><a href="namespacelczero.html#ac5cec0ebb4f6f162f521ef3bd4019d94">lczero::kSquareE1</a></div><div class="ttdeci">constexpr Square kSquareE1</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00135">types.h:135</a></div></div>
<div class="ttc" id="anamespacelczero_html_acdcd78ca075856bd7968d322394b24ef"><div class="ttname"><a href="namespacelczero.html#acdcd78ca075856bd7968d322394b24ef">lczero::kPawn</a></div><div class="ttdeci">constexpr PieceType kPawn</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00056">types.h:56</a></div></div>
<div class="ttc" id="anamespacelczero_html_aedde9b45c7086de9aa43eaed7d6e3ba1"><div class="ttname"><a href="namespacelczero.html#aedde9b45c7086de9aa43eaed7d6e3ba1">lczero::kRook</a></div><div class="ttdeci">constexpr PieceType kRook</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00054">types.h:54</a></div></div>
<div class="ttc" id="anamespacelczero_html_afa63614e6711e9ebb99a3e23266c59f1"><div class="ttname"><a href="namespacelczero.html#afa63614e6711e9ebb99a3e23266c59f1">lczero::kFileF</a></div><div class="ttdeci">constexpr File kFileF</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00082">types.h:82</a></div></div>
<div class="ttc" id="aneural_2wrapper_8cc_html_a325003364a83572b2b50eafcbc82cd5c"><div class="ttname"><a href="neural_2wrapper_8cc.html#a325003364a83572b2b50eafcbc82cd5c">result</a></div><div class="ttdeci">EvalResultPtr result</div><div class="ttdef"><b>Definition</b> <a href="neural_2wrapper_8cc_source.html#l00162">wrapper.cc:162</a></div></div>
<div class="ttc" id="arescorer_8cc_html_aec06c2e966f0428705af6846da419aaf"><div class="ttname"><a href="rescorer_8cc.html#aec06c2e966f0428705af6846da419aaf">moves</a></div><div class="ttdeci">MoveList moves</div><div class="ttdef"><b>Definition</b> <a href="rescorer_8cc_source.html#l00465">rescorer.cc:465</a></div></div>
<div class="ttc" id="astructlczero_1_1File_html"><div class="ttname"><a href="structlczero_1_1File.html">lczero::File</a></div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00059">types.h:59</a></div></div>
<div class="ttc" id="astructlczero_1_1File_html_a317da03d2cdba8b844de0aca6e1965a9"><div class="ttname"><a href="structlczero_1_1File.html#a317da03d2cdba8b844de0aca6e1965a9">lczero::File::IsValid</a></div><div class="ttdeci">constexpr bool IsValid() const</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00062">types.h:62</a></div></div>
<div class="ttc" id="astructlczero_1_1File_html_aab3b81595c3ed161d8053ad8b91a5b0b"><div class="ttname"><a href="structlczero_1_1File.html#aab3b81595c3ed161d8053ad8b91a5b0b">lczero::File::idx</a></div><div class="ttdeci">uint8_t idx</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00060">types.h:60</a></div></div>
<div class="ttc" id="astructlczero_1_1File_html_ab99e72565a1274701e4457b4228464ca"><div class="ttname"><a href="structlczero_1_1File.html#ab99e72565a1274701e4457b4228464ca">lczero::File::FromIdx</a></div><div class="ttdeci">static constexpr File FromIdx(uint8_t idx)</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00063">types.h:63</a></div></div>
<div class="ttc" id="astructlczero_1_1File_html_ac09d8b0a57f7ce474de1740081101579"><div class="ttname"><a href="structlczero_1_1File.html#ac09d8b0a57f7ce474de1740081101579">lczero::File::Parse</a></div><div class="ttdeci">static constexpr File Parse(char c)</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00064">types.h:64</a></div></div>
<div class="ttc" id="astructlczero_1_1PieceType_html"><div class="ttname"><a href="structlczero_1_1PieceType.html">lczero::PieceType</a></div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00036">types.h:36</a></div></div>
<div class="ttc" id="astructlczero_1_1PieceType_html_a4a19f318706380e3bc0194850f2c3382"><div class="ttname"><a href="structlczero_1_1PieceType.html#a4a19f318706380e3bc0194850f2c3382">lczero::PieceType::idx</a></div><div class="ttdeci">uint8_t idx</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00037">types.h:37</a></div></div>
<div class="ttc" id="astructlczero_1_1PieceType_html_aaa8792338df7836291b9f4af82d8596f"><div class="ttname"><a href="structlczero_1_1PieceType.html#aaa8792338df7836291b9f4af82d8596f">lczero::PieceType::Parse</a></div><div class="ttdeci">static PieceType Parse(char c)</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00276">types.h:276</a></div></div>
<div class="ttc" id="astructlczero_1_1PieceType_html_ad3fabcb3a76c9f1b1b993ad45f67a57e"><div class="ttname"><a href="structlczero_1_1PieceType.html#ad3fabcb3a76c9f1b1b993ad45f67a57e">lczero::PieceType::CanPromoteInto</a></div><div class="ttdeci">bool CanPromoteInto() const</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00043">types.h:43</a></div></div>
<div class="ttc" id="astructlczero_1_1PieceType_html_ae7ca48aec5190b37d320f4dd5394d983"><div class="ttname"><a href="structlczero_1_1PieceType.html#ae7ca48aec5190b37d320f4dd5394d983">lczero::PieceType::IsValid</a></div><div class="ttdeci">bool IsValid() const</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00044">types.h:44</a></div></div>
<div class="ttc" id="astructlczero_1_1Rank_html"><div class="ttname"><a href="structlczero_1_1Rank.html">lczero::Rank</a></div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00085">types.h:85</a></div></div>
<div class="ttc" id="astructlczero_1_1Rank_html_a413a5fe2c1738bdd468aaa41fc239a14"><div class="ttname"><a href="structlczero_1_1Rank.html#a413a5fe2c1738bdd468aaa41fc239a14">lczero::Rank::IsValid</a></div><div class="ttdeci">constexpr bool IsValid() const</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00087">types.h:87</a></div></div>
<div class="ttc" id="astructlczero_1_1Rank_html_a63044bd97cfe77ba65f8eaf911785b10"><div class="ttname"><a href="structlczero_1_1Rank.html#a63044bd97cfe77ba65f8eaf911785b10">lczero::Rank::Flip</a></div><div class="ttdeci">void Flip()</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00090">types.h:90</a></div></div>
<div class="ttc" id="astructlczero_1_1Rank_html_a741b063b4b071d67b1d576155b4a857c"><div class="ttname"><a href="structlczero_1_1Rank.html#a741b063b4b071d67b1d576155b4a857c">lczero::Rank::idx</a></div><div class="ttdeci">uint8_t idx</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00086">types.h:86</a></div></div>
<div class="ttc" id="astructlczero_1_1Rank_html_ab6596ab3a18d0e90e300988237407c0a"><div class="ttname"><a href="structlczero_1_1Rank.html#ab6596ab3a18d0e90e300988237407c0a">lczero::Rank::Parse</a></div><div class="ttdeci">static constexpr Rank Parse(char c)</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00089">types.h:89</a></div></div>
<div class="ttc" id="astructlczero_1_1Rank_html_aeb6a8e026c4f15d6e56f19090ad374c6"><div class="ttname"><a href="structlczero_1_1Rank.html#aeb6a8e026c4f15d6e56f19090ad374c6">lczero::Rank::FromIdx</a></div><div class="ttdeci">static constexpr Rank FromIdx(uint8_t idx)</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00088">types.h:88</a></div></div>
<div class="ttc" id="asyzygy_8cc_html_a10beb4bd4f698799676f49c292153bb5"><div class="ttname"><a href="syzygy_8cc.html#a10beb4bd4f698799676f49c292153bb5">pieces</a></div><div class="ttdeci">uint8_t pieces[7]</div><div class="ttdoc">Piece types in this configuration.</div><div class="ttdef"><b>Definition</b> <a href="syzygy_8cc_source.html#l00150">syzygy.cc:150</a></div></div>
<div class="ttc" id="asyzygy_8cc_html_abea371f9030e15a5d2a4c181576833d8"><div class="ttname"><a href="syzygy_8cc.html#abea371f9030e15a5d2a4c181576833d8">num</a></div><div class="ttdeci">uint8_t num</div><div class="ttdoc">Number of pieces in this endgame.</div><div class="ttdef"><b>Definition</b> <a href="syzygy_8cc_source.html#l00161">syzygy.cc:161</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_6d86088f2652777a7b9f92e683f4b85c.html">chess</a></li><li class="navelem"><a class="el" href="board_8cc.html">board.cc</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../images/doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
